<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>足球賠率篩選工具</title>
<style>
body{background:#f8fafd;font-family:"Microsoft JhengHei",sans-serif;margin:0}
.header{background:#1666c1;color:#fff;text-align:center;padding:36px 0 20px}
.header h1{margin:0;font-size:2.1em;letter-spacing:2px}
.header .desc{margin-top:7px;font-size:1.04em;font-weight:300}
.tabbar{display:flex;justify-content:center;background:#e7f0fb;border-bottom:2px solid #dbe7f5}
.tabbar button{flex:1;padding:15px;font-size:1.1em;font-weight:bold;background:none;border:none;border-bottom:4px solid transparent;cursor:pointer;transition:.2s}
.tabbar button.active{color:#1666c1;border-bottom:4px solid #1666c1;background:#fff}
.timestamp{text-align:center;color:#444;margin:10px 0 18px;font-size:1.07em;}
.tabcontent{max-width:920px;margin:26px auto 0;background:#fff;border-radius:8px;padding:22px;box-shadow:0 3px 18px #8ab3e929}
fieldset{margin-bottom:15px;border:1.5px solid #c3daf7;border-radius:6px;background:#f9fcff}
legend{color:#1666c1;font-weight:bold}
.row{display:flex;flex-wrap:wrap;align-items:center;margin:7px 0;}
.row label{width:120px;text-align:right;margin-right:14px;white-space:nowrap;font-size:1.09em;}
.input-wrap{flex:1;display:flex;gap:10px;}
input,select{border:1px solid #b8cef1;border-radius:4px;padding:4px 6px;margin:2px;width:110px;font-size:1em}
.input-wrap span{display:inline-block;min-width:12px;text-align:center;vertical-align:middle;position:relative;top:6px;}
button.search{padding:7px 24px;border:none;border-radius:4px;background:#1666c1;color:#fff;font-size:1em;margin-top:8px;cursor:pointer}
button.search:hover{background:#205b98}
.table-wrap{ width:100%; overflow-x:auto; margin-top:25px;}
table{width:100%;min-width:900px;border-collapse:collapse;background:#fff;margin-top:8px;font-size:1.12em;}
th,td{border:1px solid #e5e5e5;padding:9px 4px;text-align:center}
th{background:#f2f6fb;}
.stat-area{margin:32px 0 0 0;display:flex;flex-direction:column;align-items:flex-start;}
.stat-row{font-size:1.4em;font-weight:bold;margin-bottom:10px;}
.stat-row .win{color:#e53b2d;}
.stat-row .draw{color:#27a146;}
.stat-row .lose{color:#2166d1;}
.stat-info{font-size:1.03em;margin-bottom:12px;}
.piebox{display:flex;align-items:center;gap:36px;margin:20px 0 0 0;}
.piechart{width:128px;height:128px;}
.pie-legend{margin-top:16px;}
.pie-legend div{font-size:1.13em;margin-bottom:2px;display:flex;align-items:center;gap:8px;}
.pie-legend span{display:inline-block;width:16px;height:16px;border-radius:50%;margin-right:6px;}
@media(max-width:850px){
  .tabcontent{padding:13px 2vw;}
  .piechart{width:100px;height:100px;}
  table{font-size:1.02em;min-width:700px;}
}
@media(max-width:650px){
 .tabbar button{font-size:.96em;padding:11px 2px}
 .header h1{font-size:1.22em}
 .row label{width:88px;}
 .input-wrap{gap:6px;}
 input,select{width:66px;font-size:.97em}
 .piebox{gap:14px;}
 .piechart{width:68vw;height:68vw;max-width:140px;max-height:140px;}
 .stat-row{font-size:1.07em;}
 table{font-size:.98em;min-width:660px;}
}
</style>

<style>
.step-group{display:inline-flex;align-items:center;gap:4px;}

.step-group .btn-wrap button{
  padding:4px 8px;
  font-size:14px;
  line-height:1;
}

.step-group input{width:70px;}
</style>

</head>
<body>
<div class="header">
  <h1>足球賠率篩選工具</h1>
  <div class="desc">根據初盤、終盤所有條件組合快速篩選比賽，並精確統計每一項百分比。</div>
</div>

<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <span class="navbar-brand">足球賠率篩選工具</span>
    </div>
  </nav>

  <div class="container-fluid mt-3">
    <!-- nav tabs -->
    <ul class="nav nav-tabs">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#ahTab">亞洲盤查詢</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#ouTab">大小球查詢</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#euTab">歐洲盤查詢</a></li>
    </ul>

    <!-- tab content -->
    <div class="tab-content pt-3">

      <!-- ===== 亞洲盤 ===== -->
      <div class="tab-pane fade show active" id="ahTab">
        <!-- 初盤 -->
        <fieldset class="card-section">
          <legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ahInitHand" class="form-select form-select-sm">
                <option value="">--</option>
              </select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主隊賠率：</label>
            <div class="col-auto">
              <input id="ahHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahHomeErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahHomeErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客隊賠率：</label>
            <div class="col-auto">
              <input id="ahAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahAwayErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahAwayErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- 終盤 -->
        <fieldset class="card-section">
          <legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ahCloseHand" class="form-select form-select-sm">
                <option value="">--</option>
              </select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主隊賠率：</label>
            <div class="col-auto">
              <input id="ahCloseHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahCloseHomeErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahCloseHomeErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahCloseHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客隊賠率：</label>
            <div class="col-auto">
              <input id="ahCloseAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahCloseAwayErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahCloseAwayErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahCloseAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="text-center search-btn">
          <button class="btn btn-primary" onclick="doAhSearch()">搜尋</button>
        </div>

        <!-- 統計 & 表格 -->
        <div id="ahStat" class="stat-area"></div>
        <div class="table-wrap">
          <table class="table table-striped" id="ahTable">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th>
                <th>初盤盤口</th><th>初盤主隊賠率</th><th>初盤客隊賠率</th>
                <th>終盤盤口</th><th>終盤主隊賠率</th><th>終盤客隊賠率</th><th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- ===== 大小球 ===== -->
      <div class="tab-pane fade" id="ouTab">
        <!-- 初盤 -->
        <fieldset class="card-section">
          <legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ouInitLine" class="form-select form-select-sm">
                <option value="">--</option>
              </select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">大球賠率：</label>
            <div class="col-auto">
              <input id="ouBigExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouBigErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouBigErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouBigErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">細球賠率：</label>
            <div class="col-auto">
              <input id="ouSmallExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouSmallErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouSmallErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouSmallErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- 終盤 -->
        <fieldset class="card-section">
          <legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ouCloseLine" class="form-select form-select-sm">
                <option value="">--</option>
              </select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">大球賠率：</label>
            <div class="col-auto">
              <input id="ouBigExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouBigErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouBigErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouBigErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">細球賠率：</label>
            <div class="col-auto">
              <input id="ouSmallExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouSmallErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouSmallErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouSmallErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="text-center search-btn">
          <button class="btn btn-primary" onclick="doOuSearch()">搜尋</button>
        </div>

        <div id="ouStat" class="stat-area"></div>
        <div class="table-wrap">
          <table class="table table-striped" id="ouTable">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th><th>盤口</th>
                <th>初盤大</th><th>初盤細</th>
                <th>終盤盤口</th><th>終盤大</th><th>終盤細</th><th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- ===== 歐洲盤 ===== -->
      <div class="tab-pane fade" id="euTab">
        <!-- 初盤 -->
        <fieldset class="card-section">
          <legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主勝：</label>
            <div class="col-auto">
              <input id="euHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euHomeErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euHomeErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">和局：</label>
            <div class="col-auto">
              <input id="euDrawExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euDrawErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euDrawErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euDrawErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客勝：</label>
            <div class="col-auto">
              <input id="euAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euAwayErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euAwayErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- 終盤 -->
        <fieldset class="card-section">
          <legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主勝：</label>
            <div class="col-auto">
              <input id="euHomeExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euHomeErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euHomeErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euHomeErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">和局：</label>
            <div class="col-auto">
              <input id="euDrawExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euDrawErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euDrawErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euDrawErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客勝：</label>
            <div class="col-auto">
              <input id="euAwayExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euAwayErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euAwayErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euAwayErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="text-center search-btn">
          <button class="btn btn-primary" onclick="doEuSearch()">搜尋</button>
        </div>

        <div id="euStat" class="stat-area"></div>
        <div class="table-wrap">
          <table class="table table-striped" id="euTable">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th>
                <th>初盤(主/和/客)</th><th>終盤(主/和/客)</th>
                <th>比分</th><th>勝負</th><th>淨勝球</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ===== 資料載入 & 初始化 ===== -->
  <script>
    let AH=[], OU=[], EU=[];
    Promise.all([
      fetch('asian_handicap.json').then(r=>r.json()).then(d=>AH=d),
      fetch('over_under.json').then(r=>r.json()).then(d=>OU=d),
      fetch('european_odds.json').then(r=>r.json()).then(d=>EU=d),
    ]).then(initAll);

    function initAll(){
      // 亞洲盤下拉
      fillSelect('ahInitHand', new Set(AH.map(r=>r.AH_open_handicap)));
      fillSelect('ahCloseHand', new Set(AH.map(r=>r.AH_close_handicap)));
      // OU 下拉
      fillSelect('ouInitLine', new Set(OU.map(r=>r.OU_line)));
      fillSelect('ouCloseLine', new Set(OU.map(r=>r.close_OU_line)));
      // 歐洲盤不需盤口下拉
    }
    function fillSelect(id, set){
      const arr=[...set].filter(v=>v!==null&&v!==undefined).sort((a,b)=>a-b);
      document.getElementById(id).innerHTML =
        '<option value="">--</option>' +
        arr.map(v=>`<option value="${v}">${v}</option>`).join('');
    }

    // ▲▼ 調誤差
    function stepErr(id, d){
      const el=document.getElementById(id);
      let v=parseFloat(el.value)||0;
      v=Math.max(0, +(v+d).toFixed(2));
      el.value=v.toFixed(2);
    }
    // 計 min/max
    function range(exId, errId){
      const ex=parseFloat(document.getElementById(exId).value),
            er=parseFloat(document.getElementById(errId).value)||0;
      return isNaN(ex)?[null,null]:[ex-er, ex+er];
    }
    // 百分比格式
    function pct(n,t){ return t?((n/t*100).toFixed(1)+'%'):'0.0%'; }

    // ===== 亞洲盤搜尋 =====
    function doAhSearch(){
      const [hMin,hMax]=range('ahHomeExact','ahHomeErr'),
            [aMin,aMax]=range('ahAwayExact','ahAwayErr'),
            [hMinC,hMaxC]=range('ahCloseHomeExact','ahCloseHomeErr'),
            [aMinC,aMaxC]=range('ahCloseAwayExact','ahCloseAwayErr');
      const selO=document.getElementById('ahInitHand').value,
            selC=document.getElementById('ahCloseHand').value;

      const res=AH.filter(r=>{
        if(selO && r.AH_open_handicap!=+selO) return false;
        if(selC && r.AH_close_handicap!=+selC) return false;
        if(hMin!==null && (r.AH_open_home_odds<hMin||r.AH_open_home_odds>hMax)) return false;
        if(aMin!==null && (r.AH_open_away_odds<aMin||r.AH_open_away_odds>aMax)) return false;
        if(hMinC!==null && (r.AH_close_home_odds<hMinC||r.AH_close_home_odds>hMaxC)) return false;
        if(aMinC!==null && (r.AH_close_away_odds<aMinC||r.AH_close_away_odds>aMaxC)) return false;
        return true;
      });
      let win=0,draw=0,lose=0, tb=document.querySelector('#ahTable tbody');
      tb.innerHTML='';
      res.forEach(r=>{
        const [hs,as]=r.ft_score.split('-').map(Number),
              diff=(hs + r.AH_close_handicap)-as,
              out= diff>0?'贏盤':diff<0?'輸盤':'和盤';
        out==='贏盤'?win++:out==='輸盤'?lose++:draw++;
        tb.insertAdjacentHTML('beforeend',`
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.AH_open_handicap}</td><td>${r.AH_open_home_odds}</td><td>${r.AH_open_away_odds}</td>
            <td>${r.AH_close_handicap}</td><td>${r.AH_close_home_odds}</td><td>${r.AH_close_away_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot=res.length;
      // 圓餅圖
      const pie=drawPieChart([
        {label:'贏盤',val:win,color:'#e53b2d'},
        {label:'和盤',val:draw,color:'#27a146'},
        {label:'輸盤',val:lose,color:'#2166d1'}
      ]);
      document.getElementById('ahStat').innerHTML=`
        <div class="stat-row">
          <span class="win">贏盤 ${win} (${pct(win,tot)})</span>
          <span class="draw">和盤 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">輸盤 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div>場數：${tot}</div>
        <div class="piebox">${pie}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>贏盤</div>
            <div><span style="background:#27a146"></span>和盤</div>
            <div><span style="background:#2166d1"></span>輸盤</div>
          </div>
        </div>`;
    }

    // ===== 大小球搜尋 =====
    function doOuSearch(){
      const selO=document.getElementById('ouInitLine').value,
            selC=document.getElementById('ouCloseLine').value;
      const [bMin,bMax]=range('ouBigExact','ouBigErr'),
            [sMin,sMax]=range('ouSmallExact','ouSmallErr'),
            [bMinC,bMaxC]=range('ouBigExactC','ouBigErrC'),
            [sMinC,sMaxC]=range('ouSmallExactC','ouSmallErrC');

      const res=OU.filter(r=>{
        if(selO && r.OU_line!=+selO) return false;
        if(selC && r.close_OU_line!=+selC) return false;
        if(bMin!==null && (r.OU_open_over_odds<bMin||r.OU_open_over_odds>bMax)) return false;
        if(sMin!==null && (r.OU_open_under_odds<sMin||r.OU_open_under_odds>sMax)) return false;
        if(bMinC!==null && (r.OU_close_over_odds<bMinC||r.OU_close_over_odds>bMaxC)) return false;
        if(sMinC!==null && (r.OU_close_under_odds<sMinC||r.OU_close_under_odds>sMaxC)) return false;
        return true;
      });
      let over=0,push=0,under=0, tb=document.querySelector('#ouTable tbody');
      tb.innerHTML='';
      res.forEach(r=>{
        const sum=r.ft_score.split('-').reduce((a,b)=>+a+ +b,0),
              out = sum>r.close_OU_line?'大球':sum<r.close_OU_line?'小球':'走盤';
        out==='大球'?over++:out==='小球'?under++:push++;
        tb.insertAdjacentHTML('beforeend',`
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.OU_line}</td><td>${r.OU_open_over_odds}</td><td>${r.OU_open_under_odds}</td>
            <td>${r.close_OU_line}</td><td>${r.OU_close_over_odds}</td><td>${r.OU_close_under_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot=res.length;
      const pie=drawPieChart([
        {label:'大球',val:over,color:'#e53b2d'},
        {label:'走盤',val:push,color:'#27a146'},
        {label:'小球',val:under,color:'#2166d1'}
      ]);
      document.getElementById('ouStat').innerHTML=`
        <div class="stat-row">
          <span class="win">大球 ${over} (${pct(over,tot)})</span>
          <span class="draw">走盤 ${push} (${pct(push,tot)})</span>
          <span class="lose">小球 ${under} (${pct(under,tot)})</span>
        </div>
        <div>場數：${tot}</div>
        <div class="piebox">${pie}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>大球</div>
            <div><span style="background:#27a146"></span>走盤</div>
            <div><span style="background:#2166d1"></span>小球</div>
          </div>
        </div>`;
    }

    // ===== 歐洲盤搜尋 =====
    function doEuSearch(){
      const [hMin,hMax]=range('euHomeExact','euHomeErr'),
            [dMin,dMax]=range('euDrawExact','euDrawErr'),
            [aMin,aMax]=range('euAwayExact','euAwayErr'),
            [hMinC,hMaxC]=range('euHomeExactC','euHomeErrC'),
            [dMinC,dMaxC]=range('euDrawExactC','euDrawErrC'),
            [aMinC,aMaxC]=range('euAwayExactC','euAwayErrC');

      const res=EU.filter(r=>{
        if(hMin!==null && (r['1X2_open_home_odds']<hMin||r['1X2_open_home_odds']>hMax)) return false;
        if(dMin!==null && (r['1X2_open_draw_odds']<dMin||r['1X2_open_draw_odds']>dMax)) return false;
        if(aMin!==null && (r['1X2_open_away_odds']<aMin||r['1X2_open_away_odds']>aMax)) return false;
        if(hMinC!==null && (r['1X2_close_home_odds']<hMinC||r['1X2_close_home_odds']>hMaxC)) return false;
        if(dMinC!==null && (r['1X2_close_draw_odds']<dMinC||r['1X2_close_draw_odds']>dMaxC)) return false;
        if(aMinC!==null && (r['1X2_close_away_odds']<aMinC||r['1X2_close_away_odds']>aMaxC)) return false;
        return true;
      });
      let win=0,draw=0,lose=0,d1=0,d2=0,d3=0, tb=document.querySelector('#euTable tbody');
      tb.innerHTML='';
      res.forEach(r=>{
        const [hs,as]=r.ft_score.split('-').map(Number), diff=hs-as;
        if(diff>0){ win++; if(diff===1)d1++; else if(diff===2)d2++; else d3++; }
        else if(diff<0) lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend',`
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team}</td>
            <td>${r['1X2_open_home_odds']}/${r['1X2_open_draw_odds']}/${r['1X2_open_away_odds']}</td>
            <td>${r['1X2_close_home_odds']}/${r['1X2_close_draw_odds']}/${r['1X2_close_away_odds']}</td>
            <td>${r.ft_score}</td>
            <td>${ diff>0?'主勝':diff<0?'客勝':'和局' }</td>
            <td>${diff}</td>
          </tr>`);
      });
      const tot=res.length;
      const pie=drawPieChart([
        {label:'主勝',val:win,color:'#e53b2d'},
        {label:'和局',val:draw,color:'#27a146'},
        {label:'客勝',val:lose,color:'#2166d1'}
      ]);
      document.getElementById('euStat').innerHTML=`
        <div class="stat-row">
          <span class="win">主勝 ${win} (${pct(win,tot)})</span>
          <span class="draw">和局 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">客勝 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div>場數：${tot} 主勝淨勝球 → 1球:${d1} 2球:${d2} 3+球:${d3}</div>
        <div class="piebox">${pie}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>主勝</div>
            <div><span style="background:#27a146"></span>和局</div>
            <div><span style="background:#2166d1"></span>客勝</div>
          </div>
        </div>`;
    }

    // ===== 畫圓餅圖 =====
    function drawPieChart(arr){
      const tot=arr.reduce((s,x)=>s+x.val,0);
      if(!tot) return `<svg class="piechart"></svg>`;
      let cur=0, arc=[], sz=100, r=sz/2-3, cx=sz/2, cy=sz/2;
      arr.forEach(x=>{
        const v=x.val/tot, a1=cur*2*Math.PI, a2=(cur+=v)*2*Math.PI;
        const x1=cx+r*Math.sin(a1), y1=cy-r*Math.cos(a1),
              x2=cx+r*Math.sin(a2), y2=cy-r*Math.cos(a2),
              laf=(a2-a1)>Math.PI?1:0;
        arc.push(`<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${laf} 1 ${x2},${y2} Z" fill="${x.color}"></path>`);
      });
      return `<svg class="piechart" width="${sz}" height="${sz}" viewBox="0 0 ${sz} ${sz}">${arc.join('')}</svg>`;
    }
  </script>
</body>
</html>
