<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>足球賠率篩選工具</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <!-- Bootstrap Reset + Grid -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* =========================
       全域樣式、字體 & Reset
    ========================= */
    body {
      margin: 0;
      background: #f8fafd;
      font-family: "PingFang TC","Microsoft JhengHei",sans-serif;
    }
    a { text-decoration: none; }
    /* =========================
       1. Header 樣式
    ========================= */
    .header {
      background: #1666c1;
      color: #fff;
      text-align: center;
      padding: 24px 0 8px;
    }
    /* (1) 主標題放大 */
    .header h1 {
      margin: 0;
      font-size: 2.4rem;
      font-weight: bold;
    }
    /* (2) 副標題縮小且一行截斷 */
    .header .desc {
      margin: 6px 12px 0;
      font-size: 1rem;
      font-weight: 300;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* =========================
       2. TabBar
    ========================= */
    .tabbar {
      display: flex;
      background: #e7f0fb;
      border-bottom: 1px solid #dbe7f5;
    }
    .tabbar button {
      flex: 1;
      padding: 12px 0;
      font-size: 1.1rem;
      font-weight: bold;
      border: none;
      background: none;
      border-bottom: 3px solid transparent;
      cursor: pointer;
      transition: .2s;
    }
    .tabbar button.active {
      color: #1666c1;
      background: #fff;
      border-bottom: 3px solid #1666c1;
    }
    /* =========================
       3. 版本時間
    ========================= */
    .timestamp {
      text-align: center;
      color: #444;
      font-size: .95rem;
      margin: 10px 0 12px;
    }
    /* =========================
       4. Tab Content Container
    ========================= */
    .tabcontent {
      max-width: 920px;
      margin: 0 auto 24px;
      background: #fff;
      border-radius: 8px;
      padding: 20px 16px;
      box-shadow: 0 3px 18px rgba(138,179,233,.16);
    }
    @media(max-width:850px) {
      .tabcontent { padding: 16px 4vw; }
    }
    /* =========================
       5. Fieldset & Form
    ========================= */
    fieldset {
      margin-bottom: 18px;
      border: 1.5px solid #c3daf7;
      border-radius: 6px;
      background: #f9fcff;
      padding: 12px 16px 16px;
    }
    /* (3) legend 與框線留白 */
    fieldset legend {
      padding: 0 8px;
      font-size: 1.15rem;
      font-weight: bold;
      color: #1666c1;
    }
    .row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin: 8px 0;
    }
    .row label {
      width: 100px;
      text-align: right;
      margin-right: 12px;
      white-space: nowrap;
      font-size: 1.02rem;
    }
    .input-wrap {
      flex: 1;
      display: flex;
      gap: 8px;
      align-items: center;
    }
    input, select {
      border: 1px solid #b8cef1;
      border-radius: 4px;
      padding: 6px 8px;
      font-size: 1rem;
    }
    select {
      min-width: 100px;
      background: #fff;
    }
    /* ▲▼ 誤差調整群組 */
    .step-group {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .step-group input {
      width: 70px;
    }
    .btn-wrap button {
      padding: 4px 8px;
      font-size: 14px;
      line-height: 1;
      background: #fff;
      border: 1px solid #b8cef1;
      cursor: pointer;
    }
    /* 搜尋按鈕 */
    button.search {
      display: block;
      margin: 16px auto 0;
      padding: 8px 32px;
      font-size: 1.03rem;
      border: none;
      border-radius: 4px;
      background: #1666c1;
      color: #fff;
      cursor: pointer;
      transition: .2s;
    }
    button.search:hover { background: #205b98; }

    /* =========================
       6. 統計 & 餅圖
    ========================= */
    .stat-area {
      margin: 28px 0 0;
      display: flex;
      flex-direction: column;
      align-items: flex-start;
    }
    /* (4) 統計文字放大 & 一行 */
    .stat-row {
      font-size: 1.3rem;
      font-weight: bold;
      display: flex;
      flex-wrap: wrap;
      gap: 20px;
    }
    .stat-row .win  { color: #e53b2d; }
    .stat-row .draw { color: #27a146; }
    .stat-row .lose { color: #2166d1; }
    .stat-info {
      font-size: 1.05rem;
      margin: 6px 0 10px;
    }
    .piebox {
      display: flex;
      align-items: center;
      gap: 24px;
      margin-top: 12px;
    }
    .piechart {
      width: 140px;
      height: 140px;
    }
    .pie-legend div {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 1rem;
      margin-bottom: 4px;
    }
    .pie-legend span {
      display: inline-block;
      width: 16px; height: 16px;
      border-radius: 50%;
    }

    /* =========================
       7. 結果表格
    ========================= */
    .table-wrap {
      width: 100%;
      overflow-x: auto;
      margin-top: 20px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      min-width: 900px;
      font-size: 1.05rem;
    }
    th, td {
      border: 1px solid #e5e5e5;
      padding: 8px 6px;
      text-align: center;
    }
    th { background: #f2f6fb; }

    /* =========================
       8. 手機響應式
    ========================= */
    @media (max-width: 768px) {
      /* 表單欄位：上下排列 */
      fieldset .row {
        gap: 6px;
      }
      fieldset .row label {
        width: 100%;
        text-align: left;
        margin: 0 0 4px;
      }
      fieldset .row .input-wrap {
        flex: 1 1 100%;
      }
      input, select { width: 100%; }
      .step-group {
        flex: 1 1 100%;
      }
      .step-group input { width: 60%; }
      .btn-wrap {
        width: 40%;
        display: flex;
        justify-content: space-between;
      }
      button.search { width: 100%; }

      /* 統計文字與餅圖一行 */
      .stat-row { font-size: 1.1rem; gap: 8px; }
      .piebox { flex-wrap: wrap; gap: 12px; }
      .piechart { width: 100px; height: 100px; }

      /* 表格允許滑動 & 字小一點 */
      table { min-width: 600px; font-size: .9rem; }
    }
  </style>
</head>
<body>
  <!-- Header & Tabs -->
  <div class="header">
    <h1>足球賠率篩選工具</h1>
    <div class="desc">根據初盤、終盤所有條件組合快速篩選比賽，並精確統計每一項百分比。</div>
  </div>
  <div class="tabbar">
    <button id="tab1" class="active" onclick="showTab(0)">亞洲盤查詢</button>
    <button id="tab2" onclick="showTab(1)">大小球查詢</button>
    <button id="tab3" onclick="showTab(2)">歐洲盤查詢</button>
  </div>
  <div class="timestamp" id="ts">版本時間：2025/07/27 下午09:30:00 (GMT+8)</div>

  <!-- ===== 1. 亞洲盤 ===== -->
  <div class="tabcontent" id="tc1">
    <form>
      <fieldset><legend>初盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap"><select id="ahInitHand"></select></div>
        </div>
        <div class="row">
          <label>主隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ahHomeExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ahHomeErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ahHomeErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('ahHomeErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ahAwayExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ahAwayErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ahAwayErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('ahAwayErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <fieldset><legend>終盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap"><select id="ahCloseHand"></select></div>
        </div>
        <div class="row">
          <label>主隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ahCloseHomeExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ahCloseHomeErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ahCloseHomeErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('ahCloseHomeErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ahCloseAwayExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ahCloseAwayErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ahCloseAwayErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('ahCloseAwayErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <button type="button" class="search" onclick="doAhSearch()">搜尋</button>
    </form>
    <div class="stat-area" id="ahStat"></div>
    <div class="table-wrap"><table id="ahTable"><thead>
      <tr>
        <th>賽季</th><th>比賽</th>
        <th>初盤盤口</th><th>初盤主隊賠率</th><th>初盤客隊賠率</th>
        <th>終盤盤口</th><th>終盤主隊賠率</th><th>終盤客隊賠率</th><th>結果</th>
      </tr>
    </thead><tbody></tbody></table></div>
  </div>

  <!-- ===== 2. 大小球 ===== -->
  <div class="tabcontent" id="tc2" style="display:none">
    <form>
      <fieldset><legend>初盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap"><select id="ouInitLine"></select></div>
        </div>
        <div class="row">
          <label>大球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ouBigExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ouBigErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ouBigErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('ouBigErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>細球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ouSmallExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ouSmallErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ouSmallErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('ouSmallErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <fieldset><legend>終盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap"><select id="ouCloseLine"></select></div>
        </div>
        <div class="row">
          <label>大球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ouBigExactC" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ouBigErrC" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ouBigErrC',0.05)">▲</button>
                <button type="button" onclick="stepErr('ouBigErrC',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>細球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="ouSmallExactC" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="ouSmallErrC" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('ouSmallErrC',0.05)">▲</button>
                <button type="button" onclick="stepErr('ouSmallErrC',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <button type="button" class="search" onclick="doOuSearch()">搜尋</button>
    </form>
    <div class="stat-area" id="ouStat"></div>
    <div class="table-wrap"><table id="ouTable"><thead>
      <tr>
        <th>賽季</th><th>比賽</th><th>盤口</th>
        <th>初盤大</th><th>初盤細</th>
        <th>終盤盤口</th><th>終盤大</th><th>終盤細</th><th>結果</th>
      </tr>
    </thead><tbody></tbody></table></div>
  </div>

  <!-- ===== 3. 歐洲盤 ===== -->
  <div class="tabcontent" id="tc3" style="display:none">
    <form>
      <fieldset><legend>初盤</legend>
        <div class="row">
          <label>主勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="euHomeExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="euHomeErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('euHomeErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('euHomeErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>和局：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="euDrawExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="euDrawErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('euDrawErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('euDrawErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="euAwayExact" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="euAwayErr" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('euAwayErr',0.05)">▲</button>
                <button type="button" onclick="stepErr('euAwayErr',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <fieldset><legend>終盤</legend>
        <div class="row">
          <label>主勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="euHomeExactC" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="euHomeErrC" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('euHomeErrC',0.05)">▲</button>
                <button type="button" onclick="stepErr('euHomeErrC',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>和局：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="euDrawExactC" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="euDrawErrC" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('euDrawErrC',0.05)">▲</button>
                <button type="button" onclick="stepErr('euDrawErrC',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="euAwayExactC" placeholder="精確值">
            <span>±</span>
            <div class="step-group">
              <input type="number" step="0.05" id="euAwayErrC" value="0.05">
              <div class="btn-wrap">
                <button type="button" onclick="stepErr('euAwayErrC',0.05)">▲</button>
                <button type="button" onclick="stepErr('euAwayErrC',-0.05)">▼</button>
              </div>
            </div>
          </div>
        </div>
      </fieldset>
      <button type="button" class="search" onclick="doEuSearch()">搜尋</button>
    </form>
    <div class="stat-area" id="euStat"></div>
    <div class="table-wrap"><table id="euTable"><thead>
      <tr>
        <th>賽季</th><th>比賽</th><th>初盤(主/和/客)</th>
        <th>終盤(主/和/客)</th><th>比分</th><th>勝負</th><th>淨勝球</th>
      </tr>
    </thead><tbody></tbody></table></div>
  </div>

  <!-- =========================
       Data & Logic 腳本
  ========================= -->
  <script>
    // 數值範圍計算
    function range(exId, errId) {
      const ex = parseFloat(document.getElementById(exId).value);
      const er = parseFloat(document.getElementById(errId).value);
      if (isNaN(ex)) return [null, null];
      return [ex - er, ex + er];
    }
    // 百分比
    function pct(n, t) {
      return t ? ((n / t * 100).toFixed(1) + '%') : '0.0%';
    }
    // ▲▼ 誤差
    function stepErr(id, d) {
      const el = document.getElementById(id);
      let v = parseFloat(el.value) || 0;
      v = Math.max(0, +(v + d).toFixed(2));
      el.value = v.toFixed(2);
    }
    // Tab 切換
    function showTab(i) {
      ['tab1','tab2','tab3'].forEach((t,idx)=>{
        document.getElementById(t).classList.toggle('active', idx===i);
        document.getElementById('tc'+(idx+1)).style.display = (idx===i? '' : 'none');
      });
    }

    // 資料存放
    let AH = [], OU = [], EU = [];
    // 載入 JSON
    Promise.all([
      fetch('asian_handicap.json').then(r=>r.json()).then(j=>AH=j),
      fetch('over_under.json').then(r=>r.json()).then(j=>OU=j),
      fetch('european_odds.json').then(r=>r.json()).then(j=>EU=j)
    ]).then(initAll);

    function initAll(){
      // 亞洲盤下拉
      const sO = new Set(AH.map(r=>r.AH_open_handicap)),
            sC = new Set(AH.map(r=>r.AH_close_handicap));
      fillSelect('ahInitHand', sO);
      fillSelect('ahCloseHand', sC);
      // 大小球下拉
      const ouO = new Set(OU.map(r=>r.OU_line)),
            ouC = new Set(OU.map(r=>r.close_OU_line));
      fillSelect('ouInitLine', ouO);
      fillSelect('ouCloseLine', ouC);
      // 歐洲盤不需盤口
    }
    function fillSelect(id, set){
      const arr = [...set].filter(v=>v!==null&&v!==undefined).sort((a,b)=>a-b);
      let html = '<option value="">--</option>';
      arr.forEach(v=> html += `<option value="${v}">${v}</option>`);
      document.getElementById(id).innerHTML = html;
    }

    // ==== 亞洲盤搜尋 ====
    function doAhSearch(){
      const [hMin,hMax] = range('ahHomeExact','ahHomeErr'),
            [aMin,aMax] = range('ahAwayExact','ahAwayErr'),
            [hCMin,hCMax] = range('ahCloseHomeExact','ahCloseHomeErr'),
            [aCMin,aCMax] = range('ahCloseAwayExact','ahCloseAwayErr'),
            selO = document.getElementById('ahInitHand').value,
            selC = document.getElementById('ahCloseHand').value;
      let res = AH.filter(r=>{
        if (selO && r.AH_open_handicap != +selO) return false;
        if (selC && r.AH_close_handicap != +selC) return false;
        if (hMin!==null && (r.AH_open_home_odds < hMin || r.AH_open_home_odds > hMax)) return false;
        if (aMin!==null && (r.AH_open_away_odds < aMin || r.AH_open_away_odds > aMax)) return false;
        if (hCMin!==null && (r.AH_close_home_odds < hCMin || r.AH_close_home_odds > hCMax)) return false;
        if (aCMin!==null && (r.AH_close_away_odds < aCMin || r.AH_close_away_odds > aCMax)) return false;
        return true;
      });
      // 統計 & 呈現
      let win=0,draw=0,lose=0;
      const tb = document.querySelector('#ahTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number),
              diff = (hs + r.AH_close_handicap) - as,
              out = diff>0?'贏盤':diff<0?'輸盤':'和盤';
        if (out==='贏盤') win++;
        else if (out==='輸盤') lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.AH_open_handicap}</td><td>${r.AH_open_home_odds}</td><td>${r.AH_open_away_odds}</td>
            <td>${r.AH_close_handicap}</td><td>${r.AH_close_home_odds}</td><td>${r.AH_close_away_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      // 餅圖 HTML
      const pieHTML = drawPieChart([
        {label:'贏盤', val: win, color:'#e53b2d'},
        {label:'和盤', val: draw, color:'#27a146'},
        {label:'輸盤', val: lose, color:'#2166d1'}
      ]);
      document.getElementById('ahStat').innerHTML = `
        <div class="stat-row">
          <span class="win">贏盤 ${win} (${pct(win,tot)})</span>
          <span class="draw">和盤 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">輸盤 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="stat-info">場數：${tot}</div>
        <div class="piebox">
          ${pieHTML}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>贏盤</div>
            <div><span style="background:#27a146"></span>和盤</div>
            <div><span style="background:#2166d1"></span>輸盤</div>
          </div>
        </div>`;
    }

    // ==== 大小球搜尋 ====
    function doOuSearch(){
      const selO = document.getElementById('ouInitLine').value,
            selC = document.getElementById('ouCloseLine').value,
            [bMin,bMax] = range('ouBigExact','ouBigErr'),
            [sMin,sMax] = range('ouSmallExact','ouSmallErr'),
            [bCMin,bCMax] = range('ouBigExactC','ouBigErrC'),
            [sCMin,sCMax] = range('ouSmallExactC','ouSmallErrC');
      let res = OU.filter(r=>{
        if (selO && r.OU_line != +selO)     return false;
        if (selC && r.close_OU_line != +selC)return false;
        if (bMin!==null && (r.OU_open_over_odds < bMin || r.OU_open_over_odds > bMax)) return false;
        if (sMin!==null && (r.OU_open_under_odds < sMin || r.OU_open_under_odds > sMax)) return false;
        if (bCMin!==null && (r.OU_close_over_odds < bCMin || r.OU_close_over_odds > bCMax)) return false;
        if (sCMin!==null && (r.OU_close_under_odds < sCMin || r.OU_close_under_odds > sCMax)) return false;
        return true;
      });
      let over=0,push=0,under=0;
      const tb = document.querySelector('#ouTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const total = r.ft_score.split('-').reduce((a,b)=>+a+ +b,0),
              out = total > r.close_OU_line ? '大球' :
                    total < r.close_OU_line ? '小球' : '走盤';
        if (out==='大球')  over++;
        else if(out==='小球') under++;
        else push++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.OU_line}</td><td>${r.OU_open_over_odds}</td><td>${r.OU_open_under_odds}</td>
            <td>${r.close_OU_line}</td><td>${r.OU_close_over_odds}</td><td>${r.OU_close_under_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot=res.length;
      const pieHTML = drawPieChart([
        {label:'大球', val:over, color:'#e53b2d'},
        {label:'走盤',val:push, color:'#27a146'},
        {label:'小球', val:under, color:'#2166d1'}
      ]);
      document.getElementById('ouStat').innerHTML = `
        <div class="stat-row">
          <span class="win">大球 ${over} (${pct(over,tot)})</span>
          <span class="draw">走盤 ${push} (${pct(push,tot)})</span>
          <span class="lose">小球 ${under} (${pct(under,tot)})</span>
        </div>
        <div class="stat-info">場數：${tot}</div>
        <div class="piebox">
          ${pieHTML}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>大球</div>
            <div><span style="background:#27a146"></span>走盤</div>
            <div><span style="background:#2166d1"></span>小球</div>
          </div>
        </div>`;
    }

    // ==== 歐洲盤搜尋 ====
    function doEuSearch(){
      const [hMin,hMax] = range('euHomeExact','euHomeErr'),
            [dMin,dMax] = range('euDrawExact','euDrawErr'),
            [aMin,aMax] = range('euAwayExact','euAwayErr'),
            [hCMin,hCMax] = range('euHomeExactC','euHomeErrC'),
            [dCMin,dCMax] = range('euDrawExactC','euDrawErrC'),
            [aCMin,aCMax] = range('euAwayExactC','euAwayErrC');
      let res = EU.filter(r=>{
        if (hMin!==null && (r['1X2_open_home_odds']<hMin||r['1X2_open_home_odds']>hMax)) return false;
        if (dMin!==null && (r['1X2_open_draw_odds']<dMin||r['1X2_open_draw_odds']>dMax)) return false;
        if (aMin!==null && (r['1X2_open_away_odds']<aMin||r['1X2_open_away_odds']>aMax)) return false;
        if (hCMin!==null&& (r['1X2_close_home_odds']<hCMin||r['1X2_close_home_odds']>hCMax)) return false;
        if (dCMin!==null&& (r['1X2_close_draw_odds']<dCMin||r['1X2_close_draw_odds']>dCMax)) return false;
        if (aCMin!==null&& (r['1X2_close_away_odds']<aCMin||r['1X2_close_away_odds']>aCMax)) return false;
        return true;
      });
      let win=0,draw=0,lose=0,d1=0,d2=0,d3=0;
      const tb = document.querySelector('#euTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number),
              diff = hs - as,
              out = diff>0?'主勝':diff<0?'客勝':'和局';
        if (out==='主勝'){ win++; if(diff===1)d1++; else if(diff===2)d2++; else d3++; }
        else if (out==='客勝') lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team}</td>
            <td>${r['1X2_open_home_odds']}/${r['1X2_open_draw_odds']}/${r['1X2_open_away_odds']}</td>
            <td>${r['1X2_close_home_odds']}/${r['1X2_close_draw_odds']}/${r['1X2_close_away_odds']}</td>
            <td>${r.ft_score}</td>
            <td>${out}</td>
            <td>${diff}</td>
          </tr>`);
      });
      const tot=res.length;
      const pieHTML = drawPieChart([
        {label:'主勝',val:win, color:'#e53b2d'},
        {label:'和局',val:draw,color:'#27a146'},
        {label:'客勝',val:lose,color:'#2166d1'}
      ]);
      document.getElementById('euStat').innerHTML = `
        <div class="stat-row">
          <span class="win">主勝 ${win} (${pct(win,tot)})</span>
          <span class="draw">和局 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">客勝 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="stat-info">場數：${tot}  主勝淨勝球 ➜ 1球:${d1} 2球:${d2} 3+球:${d3}</div>
        <div class="piebox">
          ${pieHTML}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>主勝</div>
            <div><span style="background:#27a146"></span>和局</div>
            <div><span style="background:#2166d1"></span>客勝</div>
          </div>
        </div>`;
    }

    // ==== 畫餅圖函式 ====
    function drawPieChart(arr){
      const tot = arr.reduce((s,x)=>s + x.val, 0);
      if (!tot) return `<svg class="piechart"></svg>`;
      let cur = 0, arc = [], sz = 140, r = sz/2 - 3, cx = sz/2, cy = sz/2;
      arr.forEach(x=>{
        const v = x.val / tot,
              a1 = cur * 2 * Math.PI,
              a2 = (cur += v) * 2 * Math.PI,
              x1 = cx + r * Math.sin(a1),
              y1 = cy - r * Math.cos(a1),
              x2 = cx + r * Math.sin(a2),
              y2 = cy - r * Math.cos(a2),
              laf = (a2 - a1) > Math.PI ? 1 : 0;
        arc.push(`<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${laf} 1 ${x2},${y2} Z" fill="${x.color}"></path>`);
      });
      return `<svg class="piechart" width="${sz}" height="${sz}" viewBox="0 0 ${sz} ${sz}">${arc.join('')}</svg>`;
    }
  </script>
</body>
</html>
