<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>足球賠率篩選工具</title>
  
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

  <!-- 自訂樣式 -->
  <style>
    /* ----------------------------------------
       全局設定
    ---------------------------------------- */
    body {
      background: #f8fafd;
      font-family: "PingFang TC", "Microsoft JhengHei", sans-serif;
      margin: 0;
      padding: 0;
    }
    h1, h2, h3, h4, h5, h6 {
      margin: 0;
    }

    /* ----------------------------------------
       Header 區
    ---------------------------------------- */
    .header {
      background: #1666c1;
      color: #fff;
      text-align: center;
      padding: 20px 0 12px;
    }
    .header h1 {
      font-size: 2.2rem;    /* ① Title 放大 */
      font-weight: bold;
    }
    .header .desc {
      margin-top: 6px;
      font-size: 1rem;      /* ② 副 title 縮小 */
      font-weight: 300;
      white-space: nowrap;  /* 一行顯示 */
      overflow: hidden;
      text-overflow: ellipsis;
    }

    /* ----------------------------------------
       Tab Bar
    ---------------------------------------- */
    .tabbar {
      display: flex;
      justify-content: center;
      background: #e7f0fb;
      border-bottom: 2px solid #dbe7f5;
    }
    .tabbar button {
      flex: 1;
      padding: 14px;
      font-size: 1.05rem;
      font-weight: bold;
      background: none;
      border: none;
      border-bottom: 4px solid transparent;
      cursor: pointer;
      transition: .2s;
    }
    .tabbar button.active {
      color: #1666c1;
      border-bottom: 4px solid #1666c1;
      background: #fff;
    }

    /* ----------------------------------------
       Timestamp
    ---------------------------------------- */
    .timestamp {
      text-align: center;
      color: #444;
      margin: 8px 0 18px;
      font-size: 0.93rem;
    }

    /* ----------------------------------------
       Tab Content Wrapper
    ---------------------------------------- */
    .tabcontent {
      max-width: 940px;
      margin: 0 auto 24px;
      background: #fff;
      border-radius: 8px;
      padding: 18px;
      box-shadow: 0 3px 18px #8ab3e929;
    }

    /* ----------------------------------------
       Fieldset 樣式
    ---------------------------------------- */
    fieldset {
      margin-bottom: 16px;
      border: 1.5px solid #c3daf7;
      border-radius: 6px;
      background: #f9fcff;
      padding: 12px;
    }
    legend {
      color: #1666c1;
      font-weight: bold;
      font-size: 1.2rem;
      padding: 0 8px;
    }

    /* ----------------------------------------
       Row / Label / Input Wrap
    ---------------------------------------- */
    .row {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      margin: 6px 0;
    }
    .row label {
      width: 100px;
      text-align: right;
      margin-right: 12px;
      white-space: nowrap;
      font-size: 1rem;
    }
    .input-wrap {
      flex: 1;
      display: flex;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }
    input, select {
      border: 1px solid #b8cef1;
      border-radius: 4px;
      padding: 6px 8px;
      font-size: 1rem;
      width: 100px;
    }

    /* ▲▼ 按鈕群 */
    .btn-wrap button {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.1rem;
      line-height: 1;
      padding: 2px 6px;
    }

    /* ----------------------------------------
       搜尋按鈕
    ---------------------------------------- */
    .search {
      display: block;
      margin: 0 auto;
      padding: 8px 28px;
      background: #1666c1;
      color: #fff;
      border: none;
      border-radius: 4px;
      font-size: 1rem;
      cursor: pointer;
    }
    .search:hover {
      background: #205b98;
    }

    /* ----------------------------------------
       統計區
    ---------------------------------------- */
    .stat-area {
      margin-top: 20px;
      text-align: center;
    }
    .stat-row {
      font-size: 1.2rem;     /* ④％文字放大 */
      font-weight: bold;
      margin-bottom: 6px;
      white-space: nowrap;   /* 一行顯示 */
    }
    .stat-row .win { color: #e53b2d; }
    .stat-row .draw { color: #27a146; margin: 0 12px; }
    .stat-row .lose { color: #2166d1; }
    .stat-info {
      font-size: 1rem;
      margin-bottom: 10px;
    }

    /* 圓餅圖 & 圖例 */
    .piebox {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 12px;
    }
    .piechart {
      width: 120px;   /* ④ 放大 */
      height: 120px;
    }
    .pie-legend div {
      display: flex;
      align-items: center;
      gap: 6px;
      font-size: 0.95rem;
    }
    .pie-legend span {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
    }

    /* ----------------------------------------
       資料表格
    ---------------------------------------- */
    .table-wrap {
      width: 100%;
      overflow-x: auto;
      margin-top: 18px;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.95rem;
      min-width: 720px;  /* 手機可左右滑 */
    }
    th, td {
      border: 1px solid #e5e5e5;
      padding: 8px 6px;
      text-align: center;
      word-break: break-word;
    }
    th {
      background: #f2f6fb;
      font-weight: bold;
    }

    /* ----------------------------------------
       手機響應
    ---------------------------------------- */
    @media(max-width: 768px) {
      .header h1 { font-size: 1.8rem; }
      .header .desc { font-size: 0.85rem; }
      .tabbar button { font-size: 0.9rem; padding: 10px; }
      fieldset { padding: 8px; }
      .row label { width: 80px; margin-right: 8px; font-size: 0.9rem; }
      input, select { width: 80px; font-size: 0.9rem; padding: 4px; }
      .search { font-size: 0.9rem; padding: 6px 20px; }
      .stat-row { font-size: 1.1rem; }
      .piechart { width: 100px; height: 100px; }
      table { min-width: 600px; font-size: 0.85rem; }
    }
    @media(max-width: 480px) {
      .header h1 { font-size: 1.6rem; }
      .header .desc { font-size: 0.75rem; }
      .stat-row { font-size: 1rem; }
      .piechart { width: 80px; height: 80px; }
      table { min-width: 500px; font-size: 0.8rem; }
    }
  </style>
</head>
<body>

  <!-- ================================
       Header
  ================================= -->
  <div class="header">
    <h1>足球賠率篩選工具</h1>
    <div class="desc">
      根據初盤、終盤所有條件組合快速篩選比賽，並精確統計每一項百分比。
    </div>
  </div>

  <!-- ================================
       Tab Bar
  ================================= -->
  <div class="tabbar">
    <button id="tab1" class="active" onclick="showTab(0)">亞洲盤查詢</button>
    <button id="tab2" onclick="showTab(1)">大小球查詢</button>
    <button id="tab3" onclick="showTab(2)">歐洲盤查詢</button>
  </div>

  <!-- Timestamp -->
  <div class="timestamp" id="ts">版本時間：2025/07/27 下午09:30:00 (GMT+8)</div>


  <!-- ============= 1. 亞洲盤 ============= -->
  <div class="tabcontent" id="tc1">
    <form>
      <fieldset><legend>初盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap">
            <select id="AO"></select>
          </div>
        </div>
        <div class="row">
          <label>主隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="OHH" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="OHX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('OHX',0.01)">▲</button>
              <button type="button" onclick="adjErr('OHX',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="OAH" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="OAX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('OAX',0.01)">▲</button>
              <button type="button" onclick="adjErr('OAX',-0.01)">▼</button>
            </div>
          </div>
        </div>
      </fieldset>

      <fieldset><legend>終盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap">
            <select id="AC"></select>
          </div>
        </div>
        <div class="row">
          <label>主隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="CHH" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="CHX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('CHX',0.01)">▲</button>
              <button type="button" onclick="adjErr('CHX',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客隊賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="CAH" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="CAX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('CAX',0.01)">▲</button>
              <button type="button" onclick="adjErr('CAX',-0.01)">▼</button>
            </div>
          </div>
        </div>
      </fieldset>

      <button type="button" class="search" onclick="doAhSearch()">搜尋</button>
    </form>

    <div class="stat-area" id="ahStat"></div>
    <div class="piebox" id="ahPie"></div>
    <div class="table-wrap">
      <table class="table table-striped" id="ahTable">
        <thead>
          <tr>
            <th>賽季</th><th>比賽</th>
            <th>初盤盤口</th><th>初盤主隊賠率</th><th>初盤客隊賠率</th>
            <th>終盤盤口</th><th>終盤主隊賠率</th><th>終盤客隊賠率</th><th>盤口勝負</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>


  <!-- ============= 2. 大小球 ============= -->
  <div class="tabcontent" id="tc2" style="display:none;">
    <form>
      <fieldset><legend>初盤</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap">
            <select id="OUlineSel"></select>
          </div>
        </div>
        <div class="row">
          <label>大球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="OUoMin" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="OUoMax" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('OUoMax',0.01)">▲</button>
              <button type="button" onclick="adjErr('OUoMax',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>細球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="OUuMin" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="OUuMax" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('OUuMax',0.01)">▲</button>
              <button type="button" onclick="adjErr('OUuMax',-0.01)">▼</button>
            </div>
          </div>
        </div>
      </fieldset>

      <fieldset><legend>終盤賠率</legend>
        <div class="row">
          <label>盤口：</label>
          <div class="input-wrap">
            <select id="OUlineSelC"></select>
          </div>
        </div>
        <div class="row">
          <label>大球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="OUoMinC" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="OUoMaxC" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('OUoMaxC',0.01)">▲</button>
              <button type="button" onclick="adjErr('OUoMaxC',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>細球賠率：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="OUuMinC" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="OUuMaxC" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('OUuMaxC',0.01)">▲</button>
              <button type="button" onclick="adjErr('OUuMaxC',-0.01)">▼</button>
            </div>
          </div>
        </div>
      </fieldset>

      <button type="button" class="search" onclick="doOuSearch()">搜尋</button>
    </form>

    <div class="stat-area" id="ouStat"></div>
    <div class="piebox" id="ouPie"></div>
    <div class="table-wrap">
      <table class="table table-striped" id="ouTable">
        <thead>
          <tr>
            <th>賽季</th><th>比賽</th><th>盤口</th>
            <th>初盤大</th><th>初盤細</th>
            <th>終盤盤口</th><th>終盤大</th><th>終盤細</th><th>結果</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>


  <!-- ============= 3. 歐洲盤 ============= -->
  <div class="tabcontent" id="tc3" style="display:none;">
    <form>
      <fieldset><legend>初盤</legend>
        <div class="row">
          <label>主勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="EHOM" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="EHOX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('EHOX',0.01)">▲</button>
              <button type="button" onclick="adjErr('EHOX',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>和局：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="EDRM" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="EDRX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('EDRX',0.01)">▲</button>
              <button type="button" onclick="adjErr('EDRX',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="EAWM" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="EAWX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('EAWX',0.01)">▲</button>
              <button type="button" onclick="adjErr('EAWX',-0.01)">▼</button>
            </div>
          </div>
        </div>
      </fieldset>

      <fieldset><legend>終盤</legend>
        <div class="row">
          <label>主勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="CEHOM" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="CEHOX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('CEHOX',0.01)">▲</button>
              <button type="button" onclick="adjErr('CEHOX',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>和局：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="CEDRM" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="CEDRX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('CEDRX',0.01)">▲</button>
              <button type="button" onclick="adjErr('CEDRX',-0.01)">▼</button>
            </div>
          </div>
        </div>
        <div class="row">
          <label>客勝：</label>
          <div class="input-wrap">
            <input type="number" step="0.01" id="CEAWM" placeholder="精確值">
            <span>±</span>
            <input type="number" step="0.01" id="CEAWX" value="0.05">
            <div class="btn-wrap">
              <button type="button" onclick="adjErr('CEAWX',0.01)">▲</button>
              <button type="button" onclick="adjErr('CEAWX',-0.01)">▼</button>
            </div>
          </div>
        </div>
      </fieldset>

      <button type="button" class="search" onclick="doEuSearch()">搜尋</button>
    </form>

    <div class="stat-area" id="euStat"></div>
    <div class="piebox" id="euPie"></div>
    <div class="table-wrap">
      <table class="table table-striped" id="euTable">
        <thead>
          <tr>
            <th>賽季</th><th>比賽</th>
            <th>初盤(主/和/客)</th><th>終盤(主/和/客)</th>
            <th>比分</th><th>勝負</th><th>淨勝球</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </div>


  <!-- Bootstrap JS -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

  <!-- ===================================================================
       主程式：讀 JSON → 下拉選單 → 搜尋 & 統計 & 圓餅圖
  ==================================================================== -->
  <script>
    // 全域資料
    let AData = [], OData = [], EData = [];

    // 讀入三份 JSON
    Promise.all([
      fetch('asian_handicap.json').then(r => r.json()).then(j => AData = j),
      fetch('over_under.json').then(r => r.json()).then(j => OData = j),
      fetch('european_odds.json').then(r => r.json()).then(j => EData = j),
    ]).then(initAll);

    // 初始化所有下拉
    function initAll() {
      initAsian();
      initOU();
      initEU();  // 預留：如果歐洲盤要下拉年份或場次
    }

    // 切換 Tab
    function showTab(i) {
      ['tab1','tab2','tab3'].forEach((id,idx)=>{
        document.getElementById(id).classList.toggle('active', idx===i);
        document.getElementById('tc'+(idx+1)).style.display = idx===i ? '' : 'none';
      });
    }

    // ▲▼ 誤差微調
    function adjErr(id, delta) {
      const el = document.getElementById(id);
      let v = parseFloat(el.value) || 0;
      v = Math.max(0, +(v + delta).toFixed(2));
      el.value = v.toFixed(2);
    }

    // 計算 「精確值 ± 誤差」 → 回傳 [min, max]
    function range(exactId, errId) {
      const ex = parseFloat(document.getElementById(exactId).value);
      const er = parseFloat(document.getElementById(errId).value) || 0;
      if (isNaN(ex)) return [null, null];
      return [ex - er, ex + er];
    }

    // 百分比顯示
    function pct(n, tot) {
      return tot ? ((n / tot * 100).toFixed(1) + '%') : '0.0%';
    }

    // 繪製 Pie Chart SVG
    function drawPieChart(arr) {
      const tot = arr.reduce((s, x) => s + x.val, 0);
      if (!tot) return `<svg class="piechart"></svg>`;
      const sz = 120, r = sz/2 - 4, cx = sz/2, cy = sz/2;
      let cur = 0, arcs = '';
      arr.forEach(x=>{
        const v = x.val / tot,
              a1 = cur * 2 * Math.PI,
              a2 = (cur += v) * 2 * Math.PI,
              x1 = cx + r * Math.sin(a1), y1 = cy - r * Math.cos(a1),
              x2 = cx + r * Math.sin(a2), y2 = cy - r * Math.cos(a2),
              laf = (a2 - a1) > Math.PI ? 1 : 0;
        arcs += `<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${laf} 1 ${x2},${y2} Z" fill="${x.color}"></path>`;
      });
      return `<svg class="piechart" width="${sz}" height="${sz}" viewBox="0 0 ${sz} ${sz}">${arcs}</svg>`;
    }

    // ============================
    // ① 亞洲盤搜尋
    // ============================
    function initAsian() {
      const oSet = new Set(), cSet = new Set();
      AData.forEach(r=>{
        if (typeof r.AH_open_handicap === 'number')  oSet.add(r.AH_open_handicap);
        if (typeof r.AH_close_handicap === 'number') cSet.add(r.AH_close_handicap);
      });
      fillSelect('AO', [...oSet].sort((a,b)=>a-b));
      fillSelect('AC', [...cSet].sort((a,b)=>a-b));
    }
    function fillSelect(id, arr) {
      const sel = document.getElementById(id);
      sel.innerHTML = '<option value="">--</option>' +
        arr.map(v=>`<option value="${v}">${v}</option>`).join('');
    }
    function doAhSearch() {
      // 精確值±誤差 → range
      const [oMin,oMax] = range('OHH','OHX');
      const [aMin,aMax] = range('OAH','OAX');
      const [cMin,cMax] = range('CHH','CHX');
      const [dMin,dMax] = range('CAH','CAX');

      const selO = document.getElementById('AO').value;
      const selC = document.getElementById('AC').value;

      // 篩選
      const res = AData.filter(r=>{
        if (selO  && r.AH_open_handicap != +selO) return false;
        if (selC  && r.AH_close_handicap != +selC) return false;
        if (oMin !== null && (r.AH_open_home_odds  < oMin  || r.AH_open_home_odds  > oMax )) return false;
        if (aMin !== null && (r.AH_open_away_odds  < aMin  || r.AH_open_away_odds  > aMax )) return false;
        if (cMin !== null && (r.AH_close_home_odds < cMin  || r.AH_close_home_odds > cMax )) return false;
        if (dMin !== null && (r.AH_close_away_odds < dMin  || r.AH_close_away_odds > dMax )) return false;
        return true;
      });

      // 統計 and Render
      let win=0, draw=0, lose=0;
      const tb = document.querySelector('#ahTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number);
        const out = (hs + r.AH_close_handicap) - as > 0 ? '贏盤'
                  : (hs + r.AH_close_handicap) - as < 0 ? '輸盤' : '和盤';
        if (out==='贏盤') win++;
        else if (out==='輸盤') lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.AH_open_handicap ?? ''}</td>
            <td>${r.AH_open_home_odds ?? ''}</td>
            <td>${r.AH_open_away_odds ?? ''}</td>
            <td>${r.AH_close_handicap ?? ''}</td>
            <td>${r.AH_close_home_odds ?? ''}</td>
            <td>${r.AH_close_away_odds ?? ''}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      // 統計文字
      document.getElementById('ahStat').innerHTML = `
        <div class="stat-row">
          <span class="win">贏盤 ${win} (${pct(win,tot)})</span>
          <span class="draw">和盤 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">輸盤 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="stat-info">場數：${tot}</div>
      `;
      // 圖 + 圖例
      const pieHTML = drawPieChart([
        {label:'贏盤', val:win, color:'#e53b2d'},
        {label:'和盤', val:draw, color:'#27a146'},
        {label:'輸盤', val:lose, color:'#2166d1'}
      ]);
      document.getElementById('ahPie').innerHTML = `
        ${pieHTML}
        <div class="pie-legend">
          <div><span style="background:#e53b2d"></span>贏盤</div>
          <div><span style="background:#27a146"></span>和盤</div>
          <div><span style="background:#2166d1"></span>輸盤</div>
        </div>
      `;
    }


    // ============================
    // ② 大小球搜尋
    // ============================
    function initOU() {
      // 初盤線
      const set1 = new Set(OData.map(r=>r.OU_line));
      fillSelect('OUlineSel', [...set1].sort((a,b)=>a-b));
      // 終盤線
      const set2 = new Set(OData.map(r=>r.close_OU_line));
      fillSelect('OUlineSelC', [...set2].sort((a,b)=>a-b));
    }
    function doOuSearch() {
      const selO  = document.getElementById('OUlineSel').value;
      const selC  = document.getElementById('OUlineSelC').value;
      const [oMin,oMax] = range('OUoMin','OUoMax');
      const [uMin,uMax] = range('OUuMin','OUuMax');
      const [oMinC,oMaxC] = range('OUoMinC','OUoMaxC');
      const [uMinC,uMaxC] = range('OUuMinC','OUuMaxC');

      const res = OData.filter(r=>{
        if (selO && r.OU_line != +selO) return false;
        if (selC && r.close_OU_line != +selC) return false;
        if (oMin  !== null && (r.OU_open_over_odds  < oMin  || r.OU_open_over_odds  > oMax )) return false;
        if (uMin  !== null && (r.OU_open_under_odds < uMin  || r.OU_open_under_odds > uMax )) return false;
        if (oMinC !== null && (r.OU_close_over_odds < oMinC || r.OU_close_over_odds > oMaxC)) return false;
        if (uMinC !== null && (r.OU_close_under_odds< uMinC || r.OU_close_under_odds> uMaxC)) return false;
        return true;
      });

      let over=0, push=0, under=0;
      const tb = document.querySelector('#ouTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const goals = r.ft_score.split('-').reduce((a,b)=>+a + +b,0);
        const out = goals > r.close_OU_line ? '大球' : goals < r.close_OU_line ? '小球' : '走盤';
        if (out==='大球') over++;
        else if (out==='小球') under++;
        else push++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.OU_line}</td>
            <td>${r.OU_open_over_odds ?? ''}</td>
            <td>${r.OU_open_under_odds ?? ''}</td>
            <td>${r.close_OU_line}</td>
            <td>${r.OU_close_over_odds ?? ''}</td>
            <td>${r.OU_close_under_odds ?? ''}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      document.getElementById('ouStat').innerHTML = `
        <div class="stat-row">
          <span class="win">大球 ${over} (${pct(over,tot)})</span>
          <span class="draw">走盤 ${push} (${pct(push,tot)})</span>
          <span class="lose">小球 ${under} (${pct(under,tot)})</span>
        </div>
        <div class="stat-info">場數：${tot}</div>
      `;
      const pieHTML = drawPieChart([
        {label:'Over', val:over, color:'#e53b2d'},
        {label:'走盤', val:push, color:'#27a146'},
        {label:'Under', val:under, color:'#2166d1'}
      ]);
      document.getElementById('ouPie').innerHTML = `
        ${pieHTML}
        <div class="pie-legend">
          <div><span style="background:#e53b2d"></span>大球</div>
          <div><span style="background:#27a146"></span>走盤</div>
          <div><span style="background:#2166d1"></span>小球</div>
        </div>
      `;
    }


    // ============================
    // ③ 歐洲盤搜尋
    // ============================
    function initEU() {
      // (預留) 若日後要初始化某些下拉
    }
    function doEuSearch() {
      // 精確值±誤差 → range
      const [hMin, hMax] = range('EHOM','EHOX');
      const [dMin, dMax] = range('EDRM','EDRX');
      const [aMin, aMax] = range('EAWM','EAWX');
      const [hMinC,hMaxC] = range('CEHOM','CEHOX');
      const [dMinC,dMaxC] = range('CEDRM','CEDRX');
      const [aMinC,aMaxC] = range('CEAWM','CEAWX');

      const res = EData.filter(r=>{
        if (hMin  !== null && (r['1X2_open_home_odds']  < hMin  || r['1X2_open_home_odds']  > hMax ))  return false;
        if (dMin  !== null && (r['1X2_open_draw_odds']  < dMin  || r['1X2_open_draw_odds']  > dMax ))  return false;
        if (aMin  !== null && (r['1X2_open_away_odds']  < aMin  || r['1X2_open_away_odds']  > aMax ))  return false;
        if (hMinC !== null && (r['1X2_close_home_odds'] < hMinC || r['1X2_close_home_odds'] > hMaxC)) return false;
        if (dMinC !== null && (r['1X2_close_draw_odds'] < dMinC || r['1X2_close_draw_odds'] > dMaxC)) return false;
        if (aMinC !== null && (r['1X2_close_away_odds'] < aMinC || r['1X2_close_away_odds'] > aMaxC)) return false;
        return true;
      });

      let win=0, draw=0, lose=0, d1=0,d2=0,d3=0;
      const tb = document.querySelector('#euTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number);
        const diff = hs - as;
        const out = diff > 0 ? '主勝' : diff < 0 ? '客勝' : '和局';
        if (out==='主勝') {
          win++;
          if (diff===1) d1++;
          else if (diff===2) d2++;
          else if (diff>2) d3++;
        }
        else if (out==='客勝') {
          lose++;
        }
        else {
          draw++;
        }
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team}</td>
            <td>${r['1X2_open_home_odds']}/${r['1X2_open_draw_odds']}/${r['1X2_open_away_odds']}</td>
            <td>${r['1X2_close_home_odds']}/${r['1X2_close_draw_odds']}/${r['1X2_close_away_odds']}</td>
            <td>${r.ft_score}</td>
            <td>${out}</td>
            <td>${diff}</td>
          </tr>`);
      });

      const tot = res.length;
      document.getElementById('euStat').innerHTML = `
        <div class="stat-row">
          <span class="win">主勝 ${win} (${pct(win,tot)})</span>
          <span class="draw">和局 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">客勝 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="stat-info">
          場數：${tot} &nbsp;&nbsp; 主勝淨勝球 → 1球:${d1}  2球:${d2}  3+球:${d3}
        </div>
      `;
      const pieHTML = drawPieChart([
        {label:'主勝', val:win, color:'#e53b2d'},
        {label:'和局', val:draw, color:'#27a146'},
        {label:'客勝', val:lose, color:'#2166d1'}
      ]);
      document.getElementById('euPie').innerHTML = `
        ${pieHTML}
        <div class="pie-legend">
          <div><span style="background:#e53b2d"></span>主勝</div>
          <div><span style="background:#27a146"></span>和局</div>
          <div><span style="background:#2166d1"></span>客勝</div>
        </div>
      `;
    }
  </script>

</body>
</html>
