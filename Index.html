<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>足球歷史賠率篩選</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* ==== 版面調整 ==== */
    body {
      font-family: "PingFang TC","Microsoft JhengHei",sans-serif;
      background: #f8fafd;
      margin: 0;
    }
    /* 1. 標題放大 */
    .navbar .navbar-brand {
      font-size: 2rem;
    }
    /* 2. 副標題縮小並一行 */
    .tool-subtitle {
      font-size: 0.9rem;
      text-align: center;
      margin: 0.5rem 0 1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }
    /* 3. 卡片 padding 增加 */
    .card-section {
      background: #fff;
      border: 1px solid #cde2f7;
      border-radius: 8px;
      padding: 24px;
      margin-bottom: 20px;
    }
    .card-section legend {
      font-weight: bold;
      color: #1666c1;
    }
    .form-label {
      min-width: 80px;
    }
    /* 4. 統計區放大字與餅圖一行 */
    .stat-area {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 24px 0;
    }
    .stat-row {
      font-size: 1.5rem;
      font-weight: bold;
      margin: 0;
      white-space: nowrap;
    }
    .stat-row .win { color: #e53b2d; }
    .stat-row .draw { color: #27a146; margin: 0 1rem; }
    .stat-row .lose { color: #2166d1; }
    .piechart {
      width: 120px;
      height: 120px;
      flex-shrink: 0;
    }
    .pie-legend { font-size: 0.9rem; }
    /* 5. 手機優化 */
    @media (max-width: 767px) {
      .navbar .navbar-brand { font-size: 1.8rem; }
      .tool-subtitle { font-size: 0.85rem; }
      .card-section { padding: 16px; }
      .stat-row { font-size: 1.2rem; }
      .piechart { width: 80px; height: 80px; }
      table { font-size: 0.8rem; }
    }
    /* 6. 表格自適應 */
    .table-wrap {
      overflow-x: hidden;
    }
    .table-wrap table {
      width: 100%;
      table-layout: fixed;
    }
    .table-wrap th,
    .table-wrap td {
      overflow: hidden;
      text-overflow: ellipsis;
      white-space: nowrap;
    }
    /* ▲▼ 按鈕組 & 通用 */
    .step-group {
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }
    .step-group input {
      width: 70px;
      border-radius: 4px;
      border: 1px solid #b8cef1;
      padding: 4px;
    }
    .step-group .btn-wrap button {
      padding: 4px 8px;
      font-size: 14px;
      line-height: 1;
      border: 1px solid #b8cef1;
      background: #fff;
      cursor: pointer;
    }
    .btn-primary { min-width: 100px; }
  </style>
</head>
<body>
  <!-- 導覽列 + 標題 -->
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <span class="navbar-brand">足球歷史賠率篩選</span>
    </div>
  </nav>
  <!-- 副標題 -->
  <div class="container-fluid">
    <p class="tool-subtitle">
      根據所有條件組合快速篩選比賽，並精確統計每一項百分比。
    </p>
  </div>

  <div class="container-fluid">
    <!-- 分頁 -->
    <ul class="nav nav-tabs">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#ahTab">亞洲盤查詢</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#ouTab">大小球查詢</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#euTab">歐洲盤查詢</a></li>
    </ul>
    <div class="tab-content pt-3">

      <!-- 亞洲盤 -->
      <div class="tab-pane fade show active" id="ahTab">
        <!-- 初盤 -->
        <fieldset class="card-section">
          <legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ahInitHand" class="form-select form-select-sm"><option value="">--</option></select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主隊賠率：</label>
            <div class="col-auto">
              <input id="ahHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahHomeErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ahHomeErr',0.05)">▲</button>
                  <button onclick="stepErr('ahHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客隊賠率：</label>
            <div class="col-auto">
              <input id="ahAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahAwayErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ahAwayErr',0.05)">▲</button>
                  <button onclick="stepErr('ahAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <!-- 終盤 -->
        <fieldset class="card-section">
          <legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ahCloseHand" class="form-select form-select-sm"><option value="">--</option></select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主隊賠率：</label>
            <div class="col-auto">
              <input id="ahCloseHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahCloseHomeErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ahCloseHomeErr',0.05)">▲</button>
                  <button onclick="stepErr('ahCloseHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客隊賠率：</label>
            <div class="col-auto">
              <input id="ahCloseAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahCloseAwayErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ahCloseAwayErr',0.05)">▲</button>
                  <button onclick="stepErr('ahCloseAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="text-center mb-3">
          <button class="btn btn-primary" onclick="doAhSearch()">搜尋</button>
        </div>

        <div id="ahStat" class="stat-area"></div>
        <div class="table-wrap">
          <table class="table table-striped" id="ahTable">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th><th>初盤盤口</th><th>初盤主隊賠率</th><th>初盤客隊賠率</th>
                <th>終盤盤口</th><th>終盤主隊賠率</th><th>終盤客隊賠率</th><th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- 大小球 -->
      <div class="tab-pane fade" id="ouTab">
        <fieldset class="card-section">
          <legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ouInitLine" class="form-select form-select-sm"><option value="">--</option></select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">大球賠率：</label>
            <div class="col-auto">
              <input id="ouBigExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouBigErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ouBigErr',0.05)">▲</button>
                  <button onclick="stepErr('ouBigErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">細球賠率：</label>
            <div class="col-auto">
              <input id="ouSmallExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouSmallErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ouSmallErr',0.05)">▲</button>
                  <button onclick="stepErr('ouSmallErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset class="card-section">
          <legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ouCloseLine" class="form-select form-select-sm"><option value="">--</option></select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">大球賠率：</label>
            <div class="col-auto">
              <input id="ouBigExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouBigErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ouBigErrC',0.05)">▲</button>
                  <button onclick="stepErr('ouBigErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">細球賠率：</label>
            <div class="col-auto">
              <input id="ouSmallExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouSmallErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('ouSmallErrC',0.05)">▲</button>
                  <button onclick="stepErr('ouSmallErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="text-center mb-3">
          <button class="btn btn-primary" onclick="doOuSearch()">搜尋</button>
        </div>

        <div id="ouStat" class="stat-area"></div>
        <div class="table-wrap">
          <table class="table table-striped" id="ouTable">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th><th>盤口</th><th>初盤大</th><th>初盤細</th>
                <th>終盤盤口</th><th>終盤大</th><th>終盤細</th><th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- 歐洲盤 -->
      <div class="tab-pane fade" id="euTab">
        <fieldset class="card-section">
          <legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主勝：</label>
            <div class="col-auto">
              <input id="euHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euHomeErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('euHomeErr',0.05)">▲</button>
                  <button onclick="stepErr('euHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">和局：</label>
            <div class="col-auto">
              <input id="euDrawExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euDrawErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('euDrawErr',0.05)">▲</button>
                  <button onclick="stepErr('euDrawErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客勝：</label>
            <div class="col-auto">
              <input id="euAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euAwayErr" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('euAwayErr',0.05)">▲</button>
                  <button onclick="stepErr('euAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset class="card-section">
          <legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主勝：</label>
            <div class="col-auto">
              <input id="euHomeExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euHomeErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('euHomeErrC',0.05)">▲</button>
                  <button onclick="stepErr('euHomeErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">和局：</label>
            <div class="col-auto">
              <input id="euDrawExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euDrawErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('euDrawErrC',0.05)">▲</button>
                  <button onclick="stepErr('euDrawErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客勝：</label>
            <div class="col-auto">
              <input id="euAwayExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值">
            </div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euAwayErrC" type="number" step="0.05" class="form-control form-control-sm text-end" value="0.05">
                <div class="btn-wrap">
                  <button onclick="stepErr('euAwayErrC',0.05)">▲</button>
                  <button onclick="stepErr('euAwayErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="text-center mb-3">
          <button class="btn btn-primary" onclick="doEuSearch()">搜尋</button>
        </div>

        <div id="euStat" class="stat-area"></div>
        <div class="table-wrap">
          <table class="table table-striped" id="euTable">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th><th>初盤(主/和/客)</th><th>終盤(主/和/客)</th>
                <th>比分</th><th>勝負</th><th>淨勝球</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 資料
    let AH=[], OU=[], EU=[];
    Promise.all([
      fetch('asian_handicap.json').then(r=>r.json()).then(j=>AH=j),
      fetch('over_under.json').then(r=>r.json()).then(j=>OU=j),
      fetch('european_odds.json').then(r=>r.json()).then(j=>EU=j)
    ]).then(initAll);

    function initAll(){
      // 亞洲盤下拉
      const s1 = new Set(AH.map(r=>r.AH_open_handicap));
      const s2 = new Set(AH.map(r=>r.AH_close_handicap));
      fillSelect('ahInitHand', s1);
      fillSelect('ahCloseHand', s2);
      // OU 下拉
      fillSelect('ouInitLine', new Set(OU.map(r=>r.OU_line)));
      fillSelect('ouCloseLine', new Set(OU.map(r=>r.close_OU_line)));
    }
    function fillSelect(id, set){
      const arr=[...set].filter(v=>v!==null).sort((a,b)=>a-b);
      const sel = document.getElementById(id);
      sel.innerHTML = '<option value="">--</option>' + arr.map(v=>`<option value="${v}">${v}</option>`).join('');
    }

    // ▲▼ 誤差按鈕
    function stepErr(id, d){
      const e = document.getElementById(id);
      let v = parseFloat(e.value) || 0;
      v = Math.max(0, +(v + d).toFixed(2));
      e.value = v.toFixed(2);
    }

    // range 計算
    function range(exId, errId){
      const ex = parseFloat(document.getElementById(exId).value);
      const er = parseFloat(document.getElementById(errId).value) || 0;
      return isNaN(ex) ? [null, null] : [ex - er, ex + er];
    }

    // 百分比
    function pct(n, t){ return t ? ( (n / t * 100).toFixed(1) + '%' ) : '0.0%'; }

    // ===== 亞洲盤搜尋 =====
    function doAhSearch(){
      const [hMin,hMax] = range('ahHomeExact','ahHomeErr');
      const [aMin,aMax] = range('ahAwayExact','ahAwayErr');
      const [hMinC,hMaxC] = range('ahCloseHomeExact','ahCloseHomeErr');
      const [aMinC,aMaxC] = range('ahCloseAwayExact','ahCloseAwayErr');
      const selO = document.getElementById('ahInitHand').value;
      const selC = document.getElementById('ahCloseHand').value;
      const res = AH.filter(r=>{
        if(selO && r.AH_open_handicap != +selO) return false;
        if(selC && r.AH_close_handicap != +selC) return false;
        if(hMin!==null && (r.AH_open_home_odds < hMin || r.AH_open_home_odds > hMax)) return false;
        if(aMin!==null && (r.AH_open_away_odds < aMin || r.AH_open_away_odds > aMax)) return false;
        if(hMinC!==null && (r.AH_close_home_odds < hMinC || r.AH_close_home_odds > hMaxC)) return false;
        if(aMinC!==null && (r.AH_close_away_odds < aMinC || r.AH_close_away_odds > aMaxC)) return false;
        return true;
      });
      let win=0,draw=0,lose=0;
      const tb = document.querySelector('#ahTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number);
        const out = (hs + r.AH_close_handicap) - as > 0 ? '贏盤' :
                    (hs + r.AH_close_handicap) - as < 0 ? '輸盤' : '和盤';
        if(out==='贏盤') win++;
        else if(out==='輸盤') lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.AH_open_handicap}</td>
            <td>${r.AH_open_home_odds}</td>
            <td>${r.AH_open_away_odds}</td>
            <td>${r.AH_close_handicap}</td>
            <td>${r.AH_close_home_odds}</td>
            <td>${r.AH_close_away_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      const pieHTML = drawPieChart([
        {label:'贏盤',val:win,color:'#e53b2d'},
        {label:'和盤',val:draw,color:'#27a146'},
        {label:'輸盤',val:lose,color:'#2166d1'}
      ]);
      document.getElementById('ahStat').innerHTML = `
        <div class="stat-row">
          <span class="win">贏盤 ${win} (${pct(win,tot)})</span>
          <span class="draw">和盤 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">輸盤 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="piebox">
          ${pieHTML}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>贏盤</div>
            <div><span style="background:#27a146"></span>和盤</div>
            <div><span style="background:#2166d1"></span>輸盤</div>
          </div>
        </div>`;
    }

    // ===== 大小球搜尋 =====
    function doOuSearch(){
      const [bMin,bMax] = range('ouBigExact','ouBigErr');
      const [sMin,sMax] = range('ouSmallExact','ouSmallErr');
      const [bMinC,bMaxC] = range('ouBigExactC','ouBigErrC');
      const [sMinC,sMaxC] = range('ouSmallExactC','ouSmallErrC');
      const selO = document.getElementById('ouInitLine').value;
      const selC = document.getElementById('ouCloseLine').value;
      const res = OU.filter(r=>{
        if(selO && r.OU_line != +selO) return false;
        if(selC && r.close_OU_line != +selC) return false;
        if(bMin!==null && (r.OU_open_over_odds < bMin || r.OU_open_over_odds > bMax)) return false;
        if(sMin!==null && (r.OU_open_under_odds < sMin || r.OU_open_under_odds > sMax)) return false;
        if(bMinC!==null && (r.OU_close_over_odds < bMinC || r.OU_close_over_odds > bMaxC)) return false;
        if(sMinC!==null && (r.OU_close_under_odds < sMinC || r.OU_close_under_odds > sMaxC)) return false;
        return true;
      });
      let over=0,push=0,under=0;
      const tb = document.querySelector('#ouTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const sum = r.ft_score.split('-').reduce((a,b)=>+a+ +b,0);
        const out = sum > r.close_OU_line ? '大球' :
                    sum < r.close_OU_line ? '小球' : '走盤';
        if(out==='大球') over++;
        else if(out==='小球') under++;
        else push++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.OU_line}</td>
            <td>${r.OU_open_over_odds}</td>
            <td>${r.OU_open_under_odds}</td>
            <td>${r.close_OU_line}</td>
            <td>${r.OU_close_over_odds}</td>
            <td>${r.OU_close_under_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      const pieHTML = drawPieChart([
        {label:'大球',val:over,color:'#e53b2d'},
        {label:'走盤',val:push,color:'#27a146'},
        {label:'小球',val:under,color:'#2166d1'}
      ]);
      document.getElementById('ouStat').innerHTML = `
        <div class="stat-row">
          <span class="win">大球 ${over} (${pct(over,tot)})</span>
          <span class="draw">走盤 ${push} (${pct(push,tot)})</span>
          <span class="lose">小球 ${under} (${pct(under,tot)})</span>
        </div>
        <div class="piebox">
          ${pieHTML}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>大球</div>
            <div><span style="background:#27a146"></span>走盤</div>
            <div><span style="background:#2166d1"></span>小球</div>
          </div>
        </div>`;
    }

    // ===== 歐洲盤搜尋 =====
    function doEuSearch(){
      const [hMin,hMax] = range('euHomeExact','euHomeErr');
      const [dMin,dMax] = range('euDrawExact','euDrawErr');
      const [aMin,aMax] = range('euAwayExact','euAwayErr');
      const [hMinC,hMaxC] = range('euHomeExactC','euHomeErrC');
      const [dMinC,dMaxC] = range('euDrawExactC','euDrawErrC');
      const [aMinC,aMaxC] = range('euAwayExactC','euAwayErrC');
      const res = EU.filter(r=>{
        if(hMin!==null && (r['1X2_open_home_odds']<hMin||r['1X2_open_home_odds']>hMax)) return false;
        if(dMin!==null && (r['1X2_open_draw_odds']<dMin||r['1X2_open_draw_odds']>dMax)) return false;
        if(aMin!==null && (r['1X2_open_away_odds']<aMin||r['1X2_open_away_odds']>aMax)) return false;
        if(hMinC!==null && (r['1X2_close_home_odds']<hMinC||r['1X2_close_home_odds']>hMaxC)) return false;
        if(dMinC!==null && (r['1X2_close_draw_odds']<dMinC||r['1X2_close_draw_odds']>dMaxC)) return false;
        if(aMinC!==null && (r['1X2_close_away_odds']<aMinC||r['1X2_close_away_odds']>aMaxC)) return false;
        return true;
      });
      let win=0,draw=0,lose=0,d1=0,d2=0,d3=0;
      const tb = document.querySelector('#euTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number), diff = hs - as;
        const out = diff>0?'主勝':diff<0?'客勝':'和局';
        if(diff>0){ win++; if(diff===1)d1++; else if(diff===2)d2++; else d3++; }
        else if(diff<0) lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team}</td>
            <td>${r['1X2_open_home_odds']}/${r['1X2_open_draw_odds']}/${r['1X2_open_away_odds']}</td>
            <td>${r['1X2_close_home_odds']}/${r['1X2_close_draw_odds']}/${r['1X2_close_away_odds']}</td>
            <td>${r.ft_score}</td>
            <td>${out}</td>
            <td>${diff}</td>
          </tr>`);
      });
      const tot = res.length;
      const pieHTML = drawPieChart([
        {label:'主勝',val:win,color:'#e53b2d'},
        {label:'和局',val:draw,color:'#27a146'},
        {label:'客勝',val:lose,color:'#2166d1'}
      ]);
      document.getElementById('euStat').innerHTML = `
        <div class="stat-row">
          <span class="win">主勝 ${win} (${pct(win,tot)})</span>
          <span class="draw">和局 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">客勝 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="piebox">
          ${pieHTML}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>主勝</div>
            <div><span style="background:#27a146"></span>和局</div>
            <div><span style="background:#2166d1"></span>客勝</div>
          </div>
        </div>
        <div style="margin-top:0.5rem;">場數：${tot} 主勝淨勝球➜1球:${d1} 2球:${d2} 3+球:${d3}</div>`;
    }

    // 畫 Pie Chart
    function drawPieChart(arr){
      const tot = arr.reduce((s,x)=>s+x.val,0);
      if(!tot) return `<svg class="piechart"></svg>`;
      let cur=0, sz=120, r=sz/2-3, cx=sz/2, cy=sz/2, arc=[];
      arr.forEach(x=>{
        const v = x.val/tot, a1 = cur*2*Math.PI, a2 = (cur+=v)*2*Math.PI;
        const x1=cx+r*Math.sin(a1), y1=cy-r*Math.cos(a1),
              x2=cx+r*Math.sin(a2), y2=cy-r*Math.cos(a2),
              laf = (a2-a1)>Math.PI?1:0;
        arc.push(`<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${laf} 1 ${x2},${y2} Z" fill="${x.color}"></path>`);
      });
      return `<svg class="piechart" width="${sz}" height="${sz}" viewBox="0 0 ${sz} ${sz}">${arc.join('')}</svg>`;
    }
  </script>
</body>
</html>
