
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>大小球查詢</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>大小球查詢</h1>
    <form id="query-form">
        <label>精確盤口（初盤）：</label>
        <input type="number" step="0.25" id="exactLine" placeholder="如 2.5、2.75"><br/>
        <label>初盤大球賠率範圍：</label>
        <input type="number" step="0.01" id="overMin" placeholder="最低"> -
        <input type="number" step="0.01" id="overMax" placeholder="最高"><br/>
        <label>初盤細球賠率範圍：</label>
        <input type="number" step="0.01" id="underMin" placeholder="最低"> -
        <input type="number" step="0.01" id="underMax" placeholder="最高"><br/>
        <button type="button" onclick="search()">搜尋</button>
    </form>

    <div id="stats"></div>
    <table id="results" border="1">
        <thead>
            <tr>
                <th>比賽</th><th>盤口</th><th>結果</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
let data = [];

fetch("over_under.json")
    .then(res => res.json())
    .then(json => data = json);

function search() {
    const line = document.getElementById("exactLine").value;
    const overMin = parseFloat(document.getElementById("overMin").value);
    const overMax = parseFloat(document.getElementById("overMax").value);
    const underMin = parseFloat(document.getElementById("underMin").value);
    const underMax = parseFloat(document.getElementById("underMax").value);

    const results = data.filter(row => {
        let pass = true;
        if (line !== "") pass = pass && row.OU_line == parseFloat(line);
        if (!isNaN(overMin)) pass = pass && row.OU_open_over_odds >= overMin;
        if (!isNaN(overMax)) pass = pass && row.OU_open_over_odds <= overMax;
        if (!isNaN(underMin)) pass = pass && row.OU_open_under_odds >= underMin;
        if (!isNaN(underMax)) pass = pass && row.OU_open_under_odds <= underMax;
        return pass;
    });

    let overHit = 0, underHit = 0;
    const tbody = document.querySelector("#results tbody");
    tbody.innerHTML = "";

    results.forEach(row => {
        const ftGoals = row.ft_score.split('-').map(Number).reduce((a,b)=>a+b,0);
        const line = parseFloat(row.OU_line);
        const result = ftGoals > line ? "Over" : (ftGoals < line ? "Under" : "Push");

        if (result === "Over") overHit++;
        else if (result === "Under") underHit++;

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.home_team} vs ${row.away_team} (${row.ft_score})</td>
                        <td>${row.OU_line}</td>
                        <td>${result}</td>`;
        tbody.appendChild(tr);
    });

    const total = results.length;
    document.getElementById("stats").innerHTML = `
        <p>總場數：${total}</p>
        <p>大球：${overHit} 場 (${(overHit/total*100).toFixed(1)}%)</p>
        <p>細球：${underHit} 場 (${(underHit/total*100).toFixed(1)}%)</p>`;
}
</script>
</body>
</html>
