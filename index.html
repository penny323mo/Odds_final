<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>足球賠率 篩選工具</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
body{background:#f8fafd;font-family:"Microsoft JhengHei",sans-serif;margin:0}
.header{background:#1666c1;color:#fff;text-align:center;padding:36px 0 20px}
.header h1{margin:0;font-size:2.2em;letter-spacing:2px}
.header .desc{margin-top:7px;font-size:1.10em;font-weight:300}
.tabbar{display:flex;justify-content:center;background:#e7f0fb;border-bottom:2px solid #dbe7f5}
.tabbar button{flex:1;padding:17px;font-size:1.18em;font-weight:bold;background:none;border:none;border-bottom:4px solid transparent;cursor:pointer;transition:.2s}
.tabbar button.active{color:#1666c1;border-bottom:4px solid #1666c1;background:#fff}
.timestamp{text-align:center;color:#444;margin:14px 0 0 0;font-size:1.10em}
.tabcontent{max-width:970px;margin:32px auto 30px;background:#fff;border-radius:10px;padding:30px 28px;box-shadow:0 3px 18px #8ab3e929}
fieldset{margin-bottom:20px;border:1.5px solid #c3daf7;border-radius:7px;background:#f9fcff}
legend{color:#1666c1;font-weight:bold}
.row{display:flex;flex-wrap:wrap;align-items:center;margin:13px 0;}
.row label{width:120px;text-align:right;margin-right:14px;white-space:nowrap;font-size:1.16em;}
.input-wrap{flex:1;display:flex;gap:12px;align-items:center;}
input,select{border:1px solid #b8cef1;border-radius:4px;padding:8px 11px;margin:2px;width:120px;font-size:1.18em}
.input-wrap span {display:inline-block;vertical-align:middle;line-height:0;position:relative;top:2px;font-size:2.05em;}
button.search{padding:10px 33px;border:none;border-radius:4px;background:#1666c1;color:#fff;font-size:1.18em;margin-top:10px;cursor:pointer}
button.search:hover{background:#205b98}
.section-gap{margin-top:38px;}
.stat-area{display:flex;align-items:center;gap:38px;margin:30px 0 34px 0;}
.stat-txt{flex:2;}
.stat-txt span{font-size:2em;font-weight:900;margin-right:22px;}
.stat-txt .win{color:#f55353;}
.stat-txt .draw{color:#3eb96c;}
.stat-txt .lose{color:#3776e6;}
.piechart{width:180px;height:180px;}
.pie-legend{margin-left:40px;display:flex;flex-direction:column;gap:20px;font-size:1.30em;}
.pie-legend span{display:flex;align-items:center;gap:11px}
.pie-legend .dot{width:21px;height:21px;border-radius:50%;display:inline-block;}
.pie-legend .dot.win{background:#f55353;}
.pie-legend .dot.draw{background:#3eb96c;}
.pie-legend .dot.lose{background:#3776e6;}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:16px}
th,td{border:1px solid #e5e5e5;padding:14px 6px;text-align:center;font-size:1.25em;}
th{background:#f2f6fb;font-size:1.23em;}
@media(max-width:830px){
 .tabcontent{padding:12px 2vw;}
 .header h1{font-size:1.37em;}
 .row label{width:92px;}
 .input-wrap{gap:5px;}
 input,select{width:70px;font-size:.97em}
 .stat-area{flex-direction:column;align-items:flex-start;gap:22px}
 .pie-legend{margin:10px 0 0 0;}
 .piechart{width:100px;height:100px;}
 th,td{font-size:1.04em;}
}
</style>
</head>
<body>
<div class="header">
  <h1>足球賠率篩選工具</h1>
  <div class="desc">根據初盤、終盤所有條件組合 快速篩選比賽，並精確統計每一項百分比。</div>
</div>
<div class="tabbar">
  <button id="tab1" class="active" onclick="showTab(0)">亞洲盤查詢</button>
  <button id="tab2" onclick="showTab(1)">大小球查詢</button>
  <button id="tab3" onclick="showTab(2)">歐洲盤查詢</button>
</div>
<div class="timestamp" id="ts">版本時間：{{BUILD_TIME}}</div>

<!-- ===== 1. 亞洲盤 ===== -->
<div class="tabcontent" id="tc1">
  <form>
    <fieldset><legend>初盤</legend>
      <div class="row">
        <label>盤口：</label>
        <div class="input-wrap"><select id="AO"></select></div>
      </div>
      <div class="row">
        <label>主隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OHH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OHX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OAH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OAX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <fieldset><legend>終盤</legend>
      <div class="row">
        <label>盤口：</label>
        <div class="input-wrap"><select id="AC"></select></div>
      </div>
      <div class="row">
        <label>主隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CHH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CHX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CAH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CAX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <button type="button" class="search" onclick="asianSearch()">搜尋</button>
  </form>
  <div class="section-gap"></div>
  <div id="aStat"></div>
  <div class="section-gap"></div>
  <table id="aTbl"><thead>
    <tr>
      <th>比賽日期</th>
      <th>比賽</th>
      <th>盤口變化</th>
      <th>盤口勝負</th>
    </tr>
  </thead><tbody></tbody></table>
</div>

<!-- ===== 2. 大小球 ===== -->
<div class="tabcontent" id="tc2" style="display:none">
  <form>
    <fieldset><legend>初盤</legend>
      <div class="row">
        <label>盤口：</label>
        <div class="input-wrap"><select id="OUlineSel"></select></div>
      </div>
      <div class="row">
        <label>大球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUoMin" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUoMax" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>細球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUuMin" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUuMax" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <fieldset><legend>終盤賠率</legend>
      <div class="row">
        <label>大球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUoMinC" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUoMaxC" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>細球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUuMinC" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUuMaxC" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <button type="button" class="search" onclick="overSearch()">搜尋</button>
  </form>
  <div class="section-gap"></div>
  <div id="oStat"></div>
  <div class="section-gap"></div>
  <table id="oTbl"><thead>
    <tr>
      <th>比賽日期</th>
      <th>比賽</th>
      <th>盤口</th>
      <th>初盤大</th>
      <th>初盤細</th>
      <th>終盤大</th>
      <th>終盤細</th>
      <th>結果</th>
    </tr>
  </thead><tbody></tbody></table>
</div>

<!-- ===== 3. 歐洲盤 ===== -->
<div class="tabcontent" id="tc3" style="display:none">
  <form>
    <fieldset><legend>初盤</legend>
      <div class="row">
        <label>主勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="EHOM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="EHOX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>和局：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="EDRM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="EDRX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="EAWM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="EAWX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <fieldset><legend>終盤</legend>
      <div class="row">
        <label>主勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CEHOM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CEHOX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>和局：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CEDRM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CEDRX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CEAWM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CEAWX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <button type="button" class="search" onclick="euroSearch()">搜尋</button>
  </form>
  <div class="section-gap"></div>
  <div id="eStat"></div>
  <div class="section-gap"></div>
  <table id="eTbl"><thead>
    <tr>
      <th>比賽日期</th>
      <th>比賽</th>
      <th>初盤(主/和/客)</th>
      <th>終盤(主/和/客)</th>
      <th>比分</th>
      <th>勝負</th>
      <th>淨勝球</th>
    </tr>
  </thead><tbody></tbody></table>
</div>
<script>
/* ---- VERSION from GitHub Action ---- */
(function() {
  var el = document.getElementById("ts");
  if (typeof BUILD_TIME !== "undefined") {
    el.innerText = "版本時間：" + BUILD_TIME;
  }
})();
const pct=(n,t)=>t?((n/t*100).toFixed(1)+"%"):"0%";

/* －－ 資料預載 －－ */
let AData=[],OData=[],EData=[];
Promise.all([
 fetch("asian_handicap.json").then(r=>r.json()).then(j=>AData=j),
 fetch("over_under.json").then(r=>r.json()).then(j=>OData=j),
 fetch("european_odds.json").then(r=>r.json()).then(j=>EData=j)
]).then(()=>{initAsian();initOU();});

/* －－ Tab 切換 －－ */
function showTab(i){["tab1","tab2","tab3"].forEach((t,idx)=>{document.getElementById(t).classList.toggle("active",idx===i);document.getElementById("tc"+(idx+1)).style.display=idx===i?"":"none";});}

/* ===== ① 亞洲盤 ===== */
function initAsian(){
 const oSet=new Set(),cSet=new Set();
 AData.forEach(r=>{if(typeof r.AH_open_handicap==="number")oSet.add(r.AH_open_handicap);if(typeof r.AH_close_handicap==="number")cSet.add(r.AH_close_handicap);});
 sel("AO",oSet); sel("AC",cSet);
}
function sel(id,set){document.getElementById(id).innerHTML='<option value="">--</option>'+[...set].sort((a,b)=>a-b).map(v=>`<option>${v}</option>`).join("");}
function getDate(r){
  let d = r.date || r.match_date || r.game_date || r.match_time || "";
  if(typeof d === "number" || /^\d{12,}$/.test(d)) {
    try {
      return new Date(Number(d)).toLocaleDateString("zh-HK");
    } catch(e) { return "" }
  }
  if(typeof d === "string" && /^\d{4}-\d{2}-\d{2}/.test(d)) return d;
  return d;
}
function drawPie(id,arr,colors){
  const sum=arr.reduce((a,b)=>a+b,0),r=90,cx=90,cy=90;
  let a0=0,svg=`<svg width="180" height="180" class="piechart">`;
  arr.forEach((v,i)=>{
    const a1=a0+v/sum*2*Math.PI;
    if(v>0){
      const x0=cx+r*Math.sin(a0), y0=cy-r*Math.cos(a0);
      const x1=cx+r*Math.sin(a1), y1=cy-r*Math.cos(a1);
      const big=a1-a0>Math.PI?1:0;
      svg+=`<path d="M${cx},${cy} L${x0},${y0} A${r},${r} 0 ${big},1 ${x1},${y1} Z" fill="${colors[i]}"></path>`;
    }
    a0=a1;
  });
  svg+="</svg>";
  document.getElementById(id).innerHTML=svg;
}
function asianSearch(){
 const v=id=>parseFloat(document.getElementById(id).value);
 let res=AData.filter(r=>{
   if(document.getElementById("AO").value && r.AH_open_handicap!=v("AO"))return false;
   if(document.getElementById("AC").value && r.AH_close_handicap!=v("AC"))return false;
   if(!isNaN(v("OHH"))&&r.AH_open_home_odds<v("OHH"))return false;
   if(!isNaN(v("OHX"))&&r.AH_open_home_odds>v("OHX"))return false;
   if(!isNaN(v("OAH"))&&r.AH_open_away_odds<v("OAH"))return false;
   if(!isNaN(v("OAX"))&&r.AH_open_away_odds>v("OAX"))return false;
   if(!isNaN(v("CHH"))&&r.AH_close_home_odds<v("CHH"))return false;
   if(!isNaN(v("CHX"))&&r.AH_close_home_odds>v("CHX"))return false;
   if(!isNaN(v("CAH"))&&r.AH_close_away_odds<v("CAH"))return false;
   if(!isNaN(v("CAX"))&&r.AH_close_away_odds>v("CAX"))return false;
   return true;
 });
 let win=0,draw=0,lose=0,tb=document.querySelector("#aTbl tbody");tb.innerHTML="";
 res.forEach(r=>{
   const [h,a]=r.ft_score.split("-").map(Number),
         out=(h+r.AH_close_handicap)-a>0?"贏盤":(h+r.AH_close_handicap)-a<0?"輸盤":"和盤";
   if(out==="贏盤")win++;else if(out==="輸盤")lose++;else draw++;
   tb.insertAdjacentHTML("beforeend",`<tr>
     <td>${getDate(r)}</td>
     <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
     <td>${r.AH_movement}</td><td>${out}</td>
   </tr>`);
 });
 const tot=res.length;
 let statHTML = `<div class="stat-area">
    <div class="stat-txt">
      <span class="win">贏盤 ${win} (${pct(win,tot)})</span>
      <span class="draw">和盤 ${draw} (${pct(draw,tot)})</span>
      <span class="lose">輸盤 ${lose} (${pct(lose,tot)})</span>
      <span style="font-weight:normal;font-size:.97em;">場數：${tot}</span>
    </div>
    <div id="aPie"></div>
    <div class="pie-legend">
      <span><span class="dot win"></span>贏盤</span>
      <span><span class="dot draw"></span>和盤</span>
      <span><span class="dot lose"></span>輸盤</span>
    </div>
  </div>`;
 document.getElementById("aStat").innerHTML=statHTML;
 drawPie("aPie",[win,draw,lose],["#f55353","#3eb96c","#3776e6"]);
}

/* ===== ② 大小球 ===== */
function initOU(){
 const set=new Set(OData.map(r=>r.OU_line));
 const arr=[...set].sort((a,b)=>a-b);
 const sel=document.getElementById("OUlineSel");
 sel.innerHTML=arr.map(v=>`<option${v==2.5?" selected":""}>${v}</option>`).join("");
}
function overSearch(){
 const sel=document.getElementById("OUlineSel").value;
 const oMin=parseFloat(document.getElementById("OUoMin").value),
       oMax=parseFloat(document.getElementById("OUoMax").value),
       uMin=parseFloat(document.getElementById("OUuMin").value),
       uMax=parseFloat(document.getElementById("OUuMax").value),
       oMinC=parseFloat(document.getElementById("OUoMinC").value),
       oMaxC=parseFloat(document.getElementById("OUoMaxC").value),
       uMinC=parseFloat(document.getElementById("OUuMinC").value),
       uMaxC=parseFloat(document.getElementById("OUuMaxC").value);
 let res=OData.filter(r=>{
   if(sel && r.OU_line!=parseFloat(sel))return false;
   if(!isNaN(oMin)&&r.OU_open_over_odds<oMin)return false;
   if(!isNaN(oMax)&&r.OU_open_over_odds>oMax)return false;
   if(!isNaN(uMin)&&r.OU_open_under_odds<uMin)return false;
   if(!isNaN(uMax)&&r.OU_open_under_odds>uMax)return false;
   if(!isNaN(oMinC)&&r.OU_close_over_odds<oMinC)return false;
   if(!isNaN(oMaxC)&&r.OU_close_over_odds>oMaxC)return false;
   if(!isNaN(uMinC)&&r.OU_close_under_odds<uMinC)return false;
   if(!isNaN(uMaxC)&&r.OU_close_under_odds>uMaxC)return false;
   return true;
 });
 let over=0,under=0,tb=document.querySelector("#oTbl tbody");tb.innerHTML="";
 res.forEach(r=>{
   const goals=r.ft_score.split("-").reduce((a,b)=>parseInt(a)+parseInt(b));
   const out=goals>r.OU_line?"Over":goals<r.OU_line?"Under":"Push";
   if(out==="Over")over++;else if(out==="Under")under++;
   tb.insertAdjacentHTML("beforeend",
     `<tr>
        <td>${getDate(r)}</td>
        <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
        <td>${r.OU_line}</td>
        <td>${r.OU_open_over_odds??""}</td>
        <td>${r.OU_open_under_odds??""}</td>
        <td>${r.OU_close_over_odds??""}</td>
        <td>${r.OU_close_under_odds??""}</td>
        <td>${out}</td>
      </tr>`);
 });
 const tot=res.length;
 let statHTML = `<div class="stat-area">
    <div class="stat-txt">
      <span class="win">Over ${over} (${pct(over,tot)})</span>
      <span class="lose">Under ${under} (${pct(under,tot)})</span>
      <span style="font-weight:normal;font-size:.97em;">場數：${tot}</span>
    </div>
    <div id="oPie"></div>
    <div class="pie-legend">
      <span><span class="dot win" style="background:#f55353"></span>Over</span>
      <span><span class="dot lose" style="background:#3776e6"></span>Under</span>
    </div>
  </div>`;
 document.getElementById("oStat").innerHTML=statHTML;
 drawPie("oPie",[over,under],[ "#f55353","#3776e6"]);
}

/* ===== ③ 歐洲盤 ===== */
function euroSearch(){
 const v=id=>parseFloat(document.getElementById(id).value);
 const cv=id=>parseFloat(document.getElementById("C"+id).value);
 let res=EData.filter(r=>{
   if(!isNaN(v("EHOM"))&&r["1X2_open_home_odds"]<v("EHOM"))return false;
   if(!isNaN(v("EHOX"))&&r["1X2_open_home_odds"]>v("EHOX"))return false;
   if(!isNaN(v("EDRM"))&&r["1X2_open_draw_odds"]<v("EDRM"))return false;
   if(!isNaN(v("EDRX"))&&r["1X2_open_draw_odds"]>v("EDRX"))return false;
   if(!isNaN(v("EAWM"))&&r["1X2_open_away_odds"]<v("EAWM"))return false;
   if(!isNaN(v("EAWX"))&&r["1X2_open_away_odds"]>v("EAWX"))return false;
   if(!isNaN(cv("EHOM"))&&r["1X2_close_home_odds"]<cv("EHOM"))return false;
   if(!isNaN(cv("EHOX"))&&r["1X2_close_home_odds"]>cv("EHOX"))return false;
   if(!isNaN(cv("EDRM"))&&r["1X2_close_draw_odds"]<cv("EDRM"))return false;
   if(!isNaN(cv("EDRX"))&&r["1X2_close_draw_odds"]>cv("EDRX"))return false;
   if(!isNaN(cv("EAWM"))&&r["1X2_close_away_odds"]<cv("EAWM"))return false;
   if(!isNaN(cv("EAWX"))&&r["1X2_close_away_odds"]>cv("EAWX"))return false;
   return true;
 });
 let home=0,draw=0,away=0,d1=0,d2=0,d3=0,tb=document.querySelector("#eTbl tbody");tb.innerHTML="";
 res.forEach(r=>{
   const [h,a]=r.ft_score.split("-").map(Number),diff=h-a;
   if(diff>0){home++;if(diff==1)d1++;else if(diff==2)d2++;else d3++;}
   else if(diff<0)away++;else draw++;
   tb.insertAdjacentHTML("beforeend",
   `<tr>
     <td>${getDate(r)}</td>
     <td>${r.home_team} vs ${r.away_team}</td>
     <td>${r["1X2_open_home_odds"]}/${r["1X2_open_draw_odds"]}/${r["1X2_open_away_odds"]}</td>
     <td>${r["1X2_close_home_odds"]}/${r["1X2_close_draw_odds"]}/${r["1X2_close_away_odds"]}</td>
     <td>${r.ft_score}</td><td>${r.ft_result}</td><td>${diff}</td></tr>`);
 });
 const tot=res.length;
 let statHTML = `<div class="stat-area">
    <div class="stat-txt">
      <span class="win">主勝 ${home} (${pct(home,tot)})</span>
      <span class="draw">和局 ${draw} (${pct(draw,tot)})</span>
      <span class="lose">客勝 ${away} (${pct(away,tot)})</span>
      <span style="font-weight:normal;font-size:.97em;">場數：${tot}</span><br>
      主勝淨勝球 ➜ 1球:${d1}　2球:${d2}　3+球:${d3}
    </div>
    <div id="ePie"></div>
    <div class="pie-legend">
      <span><span class="dot win"></span>主勝</span>
      <span><span class="dot draw"></span>和局</span>
      <span><span class="dot lose"></span>客勝</span>
    </div>
  </div>`;
 document.getElementById("eStat").innerHTML=statHTML;
 drawPie("ePie",[home,draw,away],["#f55353","#3eb96c","#3776e6"]);
}
</script>
</body>
</html>
