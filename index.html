<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8" />
<title>足球賠率篩選工具</title>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<style>
body{background:#f8fafd;font-family:"Microsoft JhengHei",sans-serif;margin:0}
.header{background:#1666c1;color:#fff;text-align:center;padding:36px 0 20px}
.header h1{margin:0;font-size:2.1em;letter-spacing:2px}
.header .desc{margin-top:7px;font-size:1.04em;font-weight:300}
.tabbar{display:flex;justify-content:center;background:#e7f0fb;border-bottom:2px solid #dbe7f5}
.tabbar button{flex:1;padding:15px;font-size:1.1em;font-weight:bold;background:none;border:none;border-bottom:4px solid transparent;cursor:pointer;transition:.2s}
.tabbar button.active{color:#1666c1;border-bottom:4px solid #1666c1;background:#fff}
.timestamp{text-align:center;color:#444;margin:10px 0;font-size:1.02em}
.tabcontent{max-width:920px;margin:25px auto;background:#fff;border-radius:8px;padding:22px;box-shadow:0 3px 18px #8ab3e929}
fieldset{margin-bottom:15px;border:1.5px solid #c3daf7;border-radius:6px;background:#f9fcff}
legend{color:#1666c1;font-weight:bold}
.row{display:flex;flex-wrap:wrap;align-items:center;margin:7px 0;}
.row label{width:120px;text-align:right;margin-right:14px;white-space:nowrap;font-size:1.06em;}
.input-wrap{flex:1;display:flex;gap:10px;}
input,select{border:1px solid #b8cef1;border-radius:4px;padding:4px 6px;margin:2px;width:110px;font-size:1em}
button.search{padding:7px 24px;border:none;border-radius:4px;background:#1666c1;color:#fff;font-size:1em;margin-top:8px;cursor:pointer}
button.search:hover{background:#205b98}
table{width:100%;border-collapse:collapse;background:#fff;margin-top:10px}
th,td{border:1px solid #e5e5e5;padding:6px 4px;text-align:center}
th{background:#f2f6fb}
.stat-wrap{
  margin:10px 0 5px 0;
  font-size:1.13em;font-weight:bold;letter-spacing:1.5px;
  display:flex;flex-direction:row;align-items:center;justify-content:flex-start;gap:22px;
}
.stat-label{color:#fa6565}
.stat-label2{color:#53b952}
.stat-label3{color:#2471f7}
.pie-row{
  display:flex;flex-direction:row;align-items:center;margin:2px 0 16px 0;
}
#pieLegend{
  margin-left:24px;font-size:1em;display:flex;flex-direction:column;gap:7px;
}
.pie-dot{display:inline-block;width:15px;height:15px;border-radius:50%;margin-right:7px;vertical-align:middle;}
@media(max-width:650px){
 .tabbar button{font-size:.95em;padding:11px 2px}
 .tabcontent{padding:14px 3vw}
 .header h1{font-size:1.4em}
 .row label{width:90px;}
 .input-wrap{gap:6px;}
 input,select{width:70px;font-size:.95em}
 .stat-wrap{flex-direction:column;align-items:flex-start;gap:7px;}
 .pie-row{flex-direction:column;align-items:flex-start;}
 #pieLegend{margin-left:0;margin-top:8px;}
}
</style>
</head>
<body>
<div class="header">
  <h1>足球賠率篩選工具</h1>
  <div class="desc">根據初盤、終盤所有條件組合快速篩選比賽，並精確統計每一項百分比。</div>
</div>
<div class="tabbar">
  <button id="tab1" class="active" onclick="showTab(0)">亞洲盤查詢</button>
  <button id="tab2" onclick="showTab(1)">大小球查詢</button>
  <button id="tab3" onclick="showTab(2)">歐洲盤查詢</button>
</div>
<div class="timestamp" id="ts"></div>

<!-- ===== 1. 亞洲盤 ===== -->
<div class="tabcontent" id="tc1">
  <form>
    <fieldset><legend>初盤</legend>
      <div class="row">
        <label>盤口：</label>
        <div class="input-wrap"><select id="AO"></select></div>
      </div>
      <div class="row">
        <label>主隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OHH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OHX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OAH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OAX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <fieldset><legend>終盤</legend>
      <div class="row">
        <label>盤口：</label>
        <div class="input-wrap"><select id="AC"></select></div>
      </div>
      <div class="row">
        <label>主隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CHH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CHX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客隊賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CAH" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CAX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <button type="button" class="search" onclick="asianSearch()">搜尋</button>
  </form>
  <!-- 統計區 -->
  <div id="aStatBlock"></div>
  <!-- 圓形圖區域 -->
  <div class="pie-row" id="aPieRow" style="display:none">
    <canvas id="aPie" width="130" height="130"></canvas>
    <div id="pieLegend">
      <span><span class="pie-dot" style="background:#fa6565"></span>贏盤</span>
      <span><span class="pie-dot" style="background:#53b952"></span>和盤</span>
      <span><span class="pie-dot" style="background:#2471f7"></span>輸盤</span>
    </div>
  </div>
  <table id="aTbl"><thead>
    <tr>
      <th>比賽日期</th>
      <th>比賽</th>
      <th>盤口變化</th>
      <th>盤口勝負</th>
    </tr>
  </thead><tbody></tbody></table>
</div>

<!-- ===== 2. 大小球 ===== -->
<div class="tabcontent" id="tc2" style="display:none">
  <form>
    <fieldset><legend>初盤</legend>
      <div class="row">
        <label>盤口：</label>
        <div class="input-wrap"><select id="OUlineSel"></select></div>
      </div>
      <div class="row">
        <label>大球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUoMin" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUoMax" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>細球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUuMin" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUuMax" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <fieldset><legend>終盤賠率</legend>
      <div class="row">
        <label>大球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUoMinC" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUoMaxC" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>細球賠率：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="OUuMinC" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="OUuMaxC" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <button type="button" class="search" onclick="overSearch()">搜尋</button>
  </form>
  <div id="oStatBlock"></div>
  <div class="pie-row" id="oPieRow" style="display:none">
    <canvas id="oPie" width="130" height="130"></canvas>
    <div id="pieLegend">
      <span><span class="pie-dot" style="background:#fa6565"></span>Over</span>
      <span><span class="pie-dot" style="background:#2471f7"></span>Under</span>
    </div>
  </div>
  <table id="oTbl"><thead>
    <tr>
      <th>比賽日期</th>
      <th>比賽</th>
      <th>盤口</th>
      <th>初盤大</th>
      <th>初盤細</th>
      <th>終盤大</th>
      <th>終盤細</th>
      <th>結果</th>
    </tr>
  </thead><tbody></tbody></table>
</div>

<!-- ===== 3. 歐洲盤 ===== -->
<div class="tabcontent" id="tc3" style="display:none">
  <form>
    <fieldset><legend>初盤</legend>
      <div class="row">
        <label>主勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="EHOM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="EHOX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>和局：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="EDRM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="EDRX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="EAWM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="EAWX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <fieldset><legend>終盤</legend>
      <div class="row">
        <label>主勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CEHOM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CEHOX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>和局：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CEDRM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CEDRX" placeholder="最大值">
        </div>
      </div>
      <div class="row">
        <label>客勝：</label>
        <div class="input-wrap">
          <input type="number" step="0.01" id="CEAWM" placeholder="最小值">
          <span>–</span>
          <input type="number" step="0.01" id="CEAWX" placeholder="最大值">
        </div>
      </div>
    </fieldset>
    <button type="button" class="search" onclick="euroSearch()">搜尋</button>
  </form>
  <div id="eStatBlock"></div>
  <div class="pie-row" id="ePieRow" style="display:none">
    <canvas id="ePie" width="130" height="130"></canvas>
    <div id="pieLegend">
      <span><span class="pie-dot" style="background:#fa6565"></span>主勝</span>
      <span><span class="pie-dot" style="background:#53b952"></span>和局</span>
      <span><span class="pie-dot" style="background:#2471f7"></span>客勝</span>
    </div>
  </div>
  <table id="eTbl"><thead>
    <tr>
      <th>比賽日期</th>
      <th>比賽</th>
      <th>初盤(主/和/客)</th>
      <th>終盤(主/和/客)</th>
      <th>比分</th>
      <th>勝負</th>
      <th>淨勝球</th>
    </tr>
  </thead><tbody></tbody></table>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
const ts=document.getElementById("ts");
ts.textContent="版本時間："+new Date().toLocaleString("zh-HK",{hour12:false})+" (GMT+8)";

let AData=[],OData=[],EData=[];
Promise.all([
 fetch("asian_handicap.json").then(r=>r.json()).then(j=>AData=j),
 fetch("over_under.json").then(r=>r.json()).then(j=>OData=j),
 fetch("european_odds.json").then(r=>r.json()).then(j=>EData=j)
]).then(()=>{initAsian();initOU();});

/* －－ Tab 切換 －－ */
function showTab(i){["tab1","tab2","tab3"].forEach((t,idx)=>{document.getElementById(t).classList.toggle("active",idx===i);document.getElementById("tc"+(idx+1)).style.display=idx===i?"":"none";});}

/* ===== ① 亞洲盤 ===== */
function initAsian(){
 const oSet=new Set(),cSet=new Set();
 AData.forEach(r=>{if(typeof r.AH_open_handicap==="number")oSet.add(r.AH_open_handicap);if(typeof r.AH_close_handicap==="number")cSet.add(r.AH_close_handicap);});
 sel("AO",oSet); sel("AC",cSet);
}
function sel(id,set){document.getElementById(id).innerHTML='<option value="">--</option>'+[...set].sort((a,b)=>a-b).map(v=>`<option>${v}</option>`).join("");}
function getDate(r){
  let d = r.date || r.match_date || r.game_date || r.match_time || "";
  if(typeof d === "number" || /^\d{12,}$/.test(d)) {
    try {
      return new Date(Number(d)).toLocaleDateString("zh-HK");
    } catch(e) { return "" }
  }
  if(typeof d === "string" && /^\d{4}-\d{2}-\d{2}/.test(d)) return d;
  return d;
}
let aPieChart=null, oPieChart=null, ePieChart=null;

function asianSearch(){
 const v=id=>parseFloat(document.getElementById(id).value);
 let res=AData.filter(r=>{
   if(document.getElementById("AO").value && r.AH_open_handicap!=v("AO"))return false;
   if(document.getElementById("AC").value && r.AH_close_handicap!=v("AC"))return false;
   if(!isNaN(v("OHH"))&&r.AH_open_home_odds<v("OHH"))return false;
   if(!isNaN(v("OHX"))&&r.AH_open_home_odds>v("OHX"))return false;
   if(!isNaN(v("OAH"))&&r.AH_open_away_odds<v("OAH"))return false;
   if(!isNaN(v("OAX"))&&r.AH_open_away_odds>v("OAX"))return false;
   if(!isNaN(v("CHH"))&&r.AH_close_home_odds<v("CHH"))return false;
   if(!isNaN(v("CHX"))&&r.AH_close_home_odds>v("CHX"))return false;
   if(!isNaN(v("CAH"))&&r.AH_close_away_odds<v("CAH"))return false;
   if(!isNaN(v("CAX"))&&r.AH_close_away_odds>v("CAX"))return false;
   return true;
 });
 let win=0,draw=0,lose=0,tb=document.querySelector("#aTbl tbody");tb.innerHTML="";
 res.forEach(r=>{
   const [h,a]=r.ft_score.split("-").map(Number),
         out=(h+r.AH_close_handicap)-a>0?"贏盤":(h+r.AH_close_handicap)-a<0?"輸盤":"和盤";
   if(out==="贏盤")win++;else if(out==="輸盤")lose++;else draw++;
   tb.insertAdjacentHTML("beforeend",`<tr>
     <td>${getDate(r)}</td>
     <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
     <td>${r.AH_movement}</td><td>${out}</td>
   </tr>`);
 });
 let tot=res.length, pct=n=>tot?(n/tot*100).toFixed(1)+"%":"0.0%";
 document.getElementById("aStatBlock").innerHTML=
   `<div class="stat-wrap">
      <span class="stat-label">贏盤 ${win} (${pct(win)})</span>
      <span class="stat-label2">和盤 ${draw} (${pct(draw)})</span>
      <span class="stat-label3">輸盤 ${lose} (${pct(lose)})</span>
      <span>總場數：${tot}</span>
    </div>`;
 document.getElementById("aPieRow").style.display = tot>0 ? "" : "none";
 if(aPieChart) aPieChart.destroy();
 aPieChart = new Chart(document.getElementById('aPie'), {
   type: 'pie',
   data: {
     labels: ['贏盤','和盤','輸盤'],
     datasets: [{
       data: [win,draw,lose],
       backgroundColor: ['#fa6565','#53b952','#2471f7']
     }]
   },
   options: {plugins:{legend:{display:false}}, responsive:false}
 });
}

/* ===== ② 大小球 ===== */
function initOU(){
 const set=new Set(OData.map(r=>r.OU_line));
 const arr=[...set].sort((a,b)=>a-b);
 const sel=document.getElementById("OUlineSel");
 sel.innerHTML=arr.map(v=>`<option${v==2.5?" selected":""}>${v}</option>`).join("");
}
function overSearch(){
 const sel=document.getElementById("OUlineSel").value;
 const oMin=parseFloat(document.getElementById("OUoMin").value),
       oMax=parseFloat(document.getElementById("OUoMax").value),
       uMin=parseFloat(document.getElementById("OUuMin").value),
       uMax=parseFloat(document.getElementById("OUuMax").value),
       oMinC=parseFloat(document.getElementById("OUoMinC").value),
       oMaxC=parseFloat(document.getElementById("OUoMaxC").value),
       uMinC=parseFloat(document.getElementById("OUuMinC").value),
       uMaxC=parseFloat(document.getElementById("OUuMaxC").value);
 let res=OData.filter(r=>{
   if(sel && r.OU_line!=parseFloat(sel))return false;
   if(!isNaN(oMin)&&r.OU_open_over_odds<oMin)return false;
   if(!isNaN(oMax)&&r.OU_open_over_odds>oMax)return false;
   if(!isNaN(uMin)&&r.OU_open_under_odds<uMin)return false;
   if(!isNaN(uMax)&&r.OU_open_under_odds>uMax)return false;
   if(!isNaN(oMinC)&&r.OU_close_over_odds<oMinC)return false;
   if(!isNaN(oMaxC)&&r.OU_close_over_odds>oMaxC)return false;
   if(!isNaN(uMinC)&&r.OU_close_under_odds<uMinC)return false;
   if(!isNaN(uMaxC)&&r.OU_close_under_odds>uMaxC)return false;
   return true;
 });
 let over=0,under=0,tb=document.querySelector("#oTbl tbody");tb.innerHTML="";
 res.forEach(r=>{
   const goals=r.ft_score.split("-").reduce((a,b)=>parseInt(a)+parseInt(b));
   const out=goals>r.OU_line?"Over":goals<r.OU_line?"Under":"Push";
   if(out==="Over")over++;else if(out==="Under")under++;
   tb.insertAdjacentHTML("beforeend",
     `<tr>
        <td>${getDate(r)}</td>
        <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
        <td>${r.OU_line}</td>
        <td>${r.OU_open_over_odds??""}</td>
        <td>${r.OU_open_under_odds??""}</td>
        <td>${r.OU_close_over_odds??""}</td>
        <td>${r.OU_close_under_odds??""}</td>
        <td>${out}</td>
      </tr>`);
 });
 let tot=res.length, pct=n=>tot?(n/tot*100).toFixed(1)+"%":"0.0%";
 document.getElementById("oStatBlock").innerHTML=
   `<div class="stat-wrap">
      <span class="stat-label">Over ${over} (${pct(over)})</span>
      <span class="stat-label3">Under ${under} (${pct(under)})</span>
      <span>總場數：${tot}</span>
    </div>`;
 document.getElementById("oPieRow").style.display = tot>0 ? "" : "none";
 if(oPieChart) oPieChart.destroy();
 oPieChart = new Chart(document.getElementById('oPie'), {
   type: 'pie',
   data: {
     labels: ['Over','Under'],
     datasets: [{
       data: [over,under],
       backgroundColor: ['#fa6565','#2471f7']
     }]
   },
   options: {plugins:{legend:{display:false}}, responsive:false}
 });
}

/* ===== ③ 歐洲盤 ===== */
function euroSearch(){
 const v=id=>parseFloat(document.getElementById(id).value);
 const cv=id=>parseFloat(document.getElementById("C"+id).value);
 let res=EData.filter(r=>{
   if(!isNaN(v("EHOM"))&&r["1X2_open_home_odds"]<v("EHOM"))return false;
   if(!isNaN(v("EHOX"))&&r["1X2_open_home_odds"]>v("EHOX"))return false;
   if(!isNaN(v("EDRM"))&&r["1X2_open_draw_odds"]<v("EDRM"))return false;
   if(!isNaN(v("EDRX"))&&r["1X2_open_draw_odds"]>v("EDRX"))return false;
   if(!isNaN(v("EAWM"))&&r["1X2_open_away_odds"]<v("EAWM"))return false;
   if(!isNaN(v("EAWX"))&&r["1X2_open_away_odds"]>v("EAWX"))return false;
   if(!isNaN(cv("EHOM"))&&r["1X2_close_home_odds"]<cv("EHOM"))return false;
   if(!isNaN(cv("EHOX"))&&r["1X2_close_home_odds"]>cv("EHOX"))return false;
   if(!isNaN(cv("EDRM"))&&r["1X2_close_draw_odds"]<cv("EDRM"))return false;
   if(!isNaN(cv("EDRX"))&&r["1X2_close_draw_odds"]>cv("EDRX"))return false;
   if(!isNaN(cv("EAWM"))&&r["1X2_close_away_odds"]<cv("EAWM"))return false;
   if(!isNaN(cv("EAWX"))&&r["1X2_close_away_odds"]>cv("EAWX"))return false;
   return true;
 });
 let home=0,draw=0,away=0,tb=document.querySelector("#eTbl tbody");tb.innerHTML="";
 res.forEach(r=>{
   const [h,a]=r.ft_score.split("-").map(Number),diff=h-a;
   if(diff>0){home++;} else if(diff<0)away++; else draw++;
   tb.insertAdjacentHTML("beforeend",
   `<tr>
     <td>${getDate(r)}</td>
     <td>${r.home_team} vs ${r.away_team}</td>
     <td>${r["1X2_open_home_odds"]}/${r["1X2_open_draw_odds"]}/${r["1X2_open_away_odds"]}</td>
     <td>${r["1X2_close_home_odds"]}/${r["1X2_close_draw_odds"]}/${r["1X2_close_away_odds"]}</td>
     <td>${r.ft_score}</td><td>${r.ft_result}</td><td>${diff}</td></tr>`);
 });
 let tot=res.length, pct=n=>tot?(n/tot*100).toFixed(1)+"%":"0.0%";
 document.getElementById("eStatBlock").innerHTML=
   `<div class="stat-wrap">
      <span class="stat-label">主勝 ${home} (${pct(home)})</span>
      <span class="stat-label2">和局 ${draw} (${pct(draw)})</span>
      <span class="stat-label3">客勝 ${away} (${pct(away)})</span>
      <span>總場數：${tot}</span>
    </div>`;
 document.getElementById("ePieRow").style.display = tot>0 ? "" : "none";
 if(ePieChart) ePieChart.destroy();
 ePieChart = new Chart(document.getElementById('ePie'), {
   type: 'pie',
   data: {
     labels: ['主勝','和局','客勝'],
     datasets: [{
       data: [home,draw,away],
       backgroundColor: ['#fa6565','#53b952','#2471f7']
     }]
   },
   options: {plugins:{legend:{display:false}}, responsive:false}
 });
}
</script>
</body>
</html>
