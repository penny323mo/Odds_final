
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8" />
    <title>亞洲盤查詢</title>
    <link rel="stylesheet" href="style.css" />
</head>
<body>
    <h1>亞洲讓球盤查詢</h1>
    <form id="query-form">
        <fieldset>
            <legend>初盤條件</legend>
            精確讓球盤口：
            <select id="exactOpenHandicap">
                <option value="">--請選擇--</option>
                <option value="-3.25">-3.25</option>
<option value="-3.0">-3.0</option>
<option value="-2.75">-2.75</option>
<option value="-2.5">-2.5</option>
<option value="-2.25">-2.25</option>
<option value="-2.0">-2.0</option>
<option value="-1.75">-1.75</option>
<option value="-1.5">-1.5</option>
<option value="-1.25">-1.25</option>
<option value="-1.0">-1.0</option>
<option value="-0.75">-0.75</option>
<option value="-0.5">-0.5</option>
<option value="-0.25">-0.25</option>
<option value="0.0">0.0</option>
<option value="0.25">0.25</option>
<option value="0.5">0.5</option>
<option value="0.75">0.75</option>
<option value="1.0">1.0</option>
<option value="1.25">1.25</option>
<option value="1.5">1.5</option>
<option value="1.75">1.75</option>
<option value="2.0">2.0</option>
<option value="2.25">2.25</option>
<option value="2.5">2.5</option>
<option value="2.75">2.75</option>
            </select><br/>
            主隊賠率範圍：
            <input type="number" step="0.01" id="openHomeMin" placeholder="最低"> -
            <input type="number" step="0.01" id="openHomeMax" placeholder="最高"><br/>
            客隊賠率範圍：
            <input type="number" step="0.01" id="openAwayMin" placeholder="最低"> -
            <input type="number" step="0.01" id="openAwayMax" placeholder="最高"><br/>
        </fieldset>
        <fieldset>
            <legend>終盤條件</legend>
            精確讓球盤口：
            <select id="exactCloseHandicap">
                <option value="">--請選擇--</option>
                <option value="-3.75">-3.75</option>
<option value="-3.25">-3.25</option>
<option value="-3.0">-3.0</option>
<option value="-2.75">-2.75</option>
<option value="-2.5">-2.5</option>
<option value="-2.25">-2.25</option>
<option value="-2.0">-2.0</option>
<option value="-1.75">-1.75</option>
<option value="-1.5">-1.5</option>
<option value="-1.25">-1.25</option>
<option value="-1.0">-1.0</option>
<option value="-0.75">-0.75</option>
<option value="-0.5">-0.5</option>
<option value="-0.25">-0.25</option>
<option value="0.0">0.0</option>
<option value="0.25">0.25</option>
<option value="0.5">0.5</option>
<option value="0.75">0.75</option>
<option value="1.0">1.0</option>
<option value="1.25">1.25</option>
<option value="1.5">1.5</option>
<option value="1.75">1.75</option>
<option value="2.0">2.0</option>
<option value="2.25">2.25</option>
<option value="2.5">2.5</option>
<option value="2.75">2.75</option>
<option value="3.0">3.0</option>
            </select><br/>
            主隊賠率範圍：
            <input type="number" step="0.01" id="closeHomeMin" placeholder="最低"> -
            <input type="number" step="0.01" id="closeHomeMax" placeholder="最高"><br/>
            客隊賠率範圍：
            <input type="number" step="0.01" id="closeAwayMin" placeholder="最低"> -
            <input type="number" step="0.01" id="closeAwayMax" placeholder="最高"><br/>
        </fieldset>
        <button type="button" onclick="search()">搜尋</button>
    </form>

    <div id="stats"></div>
    <table id="results" border="1">
        <thead>
            <tr><th>比賽</th><th>盤口變化</th><th>盤口勝負</th></tr>
        </thead>
        <tbody></tbody>
    </table>

<script>
let data = [];
fetch("asian_handicap.json")
    .then(res => res.json())
    .then(json => data = json);

function search() {
    const openHomeMin = parseFloat(document.getElementById("openHomeMin").value);
    const openHomeMax = parseFloat(document.getElementById("openHomeMax").value);
    const openAwayMin = parseFloat(document.getElementById("openAwayMin").value);
    const openAwayMax = parseFloat(document.getElementById("openAwayMax").value);
    const closeHomeMin = parseFloat(document.getElementById("closeHomeMin").value);
    const closeHomeMax = parseFloat(document.getElementById("closeHomeMax").value);
    const closeAwayMin = parseFloat(document.getElementById("closeAwayMin").value);
    const closeAwayMax = parseFloat(document.getElementById("closeAwayMax").value);
    const exactOpen = document.getElementById("exactOpenHandicap").value;
    const exactClose = document.getElementById("exactCloseHandicap").value;

    const results = data.filter(row => {
        let pass = true;
        if (exactOpen !== "") pass = pass && row.AH_open_handicap == parseFloat(exactOpen);
        if (!isNaN(openHomeMin)) pass = pass && row.AH_open_home_odds >= openHomeMin;
        if (!isNaN(openHomeMax)) pass = pass && row.AH_open_home_odds <= openHomeMax;
        if (!isNaN(openAwayMin)) pass = pass && row.AH_open_away_odds >= openAwayMin;
        if (!isNaN(openAwayMax)) pass = pass && row.AH_open_away_odds <= openAwayMax;
        if (exactClose !== "") pass = pass && row.AH_close_handicap == parseFloat(exactClose);
        if (!isNaN(closeHomeMin)) pass = pass && row.AH_close_home_odds >= closeHomeMin;
        if (!isNaN(closeHomeMax)) pass = pass && row.AH_close_home_odds <= closeHomeMax;
        if (!isNaN(closeAwayMin)) pass = pass && row.AH_close_away_odds >= closeAwayMin;
        if (!isNaN(closeAwayMax)) pass = pass && row.AH_close_away_odds <= closeAwayMax;
        return pass;
    });

    let win = 0, lose = 0, draw = 0;
    const tbody = document.querySelector("#results tbody");
    tbody.innerHTML = "";

    results.forEach(row => {
        // 計算正確的讓球盤口勝負：主隊入球＋終盤讓球－客隊入球
        let ft = row.ft_score.split("-");
        let homeGoal = parseInt(ft[0]);
        let awayGoal = parseInt(ft[1]);
        let handicap = parseFloat(row.AH_close_handicap);

        let outcome = "";
        let calc = (homeGoal + handicap) - awayGoal;
        if (calc > 0) {
            win++;
            outcome = "贏盤";
        } else if (calc === 0) {
            draw++;
            outcome = "和盤";
        } else {
            lose++;
            outcome = "輸盤";
        }

        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row.home_team} vs ${row.away_team} (${row.ft_score})</td>
                        <td>${row.AH_movement}</td>
                        <td>${outcome}</td>`;
        tbody.appendChild(tr);
    });

    const total = results.length;
    document.getElementById("stats").innerHTML = `
        <p>總場數：${total}</p>
        <p>主隊贏盤：${win} 場 (${(win/total*100).toFixed(1)}%)</p>
        <p>主隊輸盤：${lose} 場 (${(lose/total*100).toFixed(1)}%)</p>
        <p>和盤：${draw} 場 (${(draw/total*100).toFixed(1)}%)</p>`;
}
</script>
</body>
</html>
