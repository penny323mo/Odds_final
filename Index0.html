<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>足球賠率篩選工具</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    /* === 共用樣式 === */
    html { font-size: 16px; }
    body {
      font-family: "PingFang TC","Microsoft JhengHei",sans-serif;
      background: #f8fafd;
      margin: 0;
      padding: 0;
    }
    /* 1. 更大標題 */
    .navbar-brand {
      font-size: 2rem;
      font-weight: bold;
    }
    /* 2. 副標題一行顯示，自動截斷 */
    .header-subtitle {
      font-size: 0.9rem;
      color: #eef5fb;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      margin: 0.5rem 0;
    }
    /* Tab 樣式 */
    .nav-tabs .nav-link { font-size: 1rem; }
    .nav-tabs .nav-link.active { font-weight: bold; }
    /* 3. 卡片 & 分區：增加 legend 與邊框間距 */
    .card-section {
      background: #fff;
      border: 1px solid #cde2f7;
      border-radius: 8px;
      padding: 1rem;
      margin-top: 1.25rem;
      position: relative;
    }
    .card-section legend {
      font-weight: bold;
      color: #1666c1;
      margin-left: 0.5rem;
      padding: 0 0.5rem;
    }
    .card-section .form-label {
      min-width: 75px;
    }
    .form-control, .form-select {
      min-width: 5rem;
    }
    .step-group {
      display: inline-flex;
      align-items: center;
      gap: 0.25rem;
    }
    .step-group input {
      width: 4rem;
      text-align: right;
      padding: 0.2rem;
    }
    .step-group .btn-wrap button {
      padding: 0.2rem 0.4rem;
      font-size: 0.9rem;
      line-height: 1;
      border: 1px solid #b8cef1;
      background: #fff;
      cursor: pointer;
    }
    /* 4. 統計欄目放大一行顯示 */
    .stat-area {
      margin-top: 1rem;
    }
    .stat-row {
      display: flex;
      justify-content: center;
      gap: 1.5rem;
      font-size: 1.2rem;
      font-weight: bold;
      white-space: nowrap;
    }
    .stat-row .win { color: #e53b2d; }
    .stat-row .draw { color: #27a146; }
    .stat-row .lose { color: #2166d1; }
    .piebox {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1.5rem;
      margin-top: 0.75rem;
    }
    .piechart {
      width: 120px;
      height: 120px;
    }
    .pie-legend div {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      font-size: 0.9rem;
    }
    .pie-legend span {
      display: inline-block;
      width: 14px;
      height: 14px;
      border-radius: 50%;
    }
    /* 6. 手機響應：自動縮表格字體 */
    .table-wrap {
      width: 100%;
      overflow-x: auto;
      margin-top: 1rem;
    }
    table {
      width: 100%;
      table-layout: fixed;
      font-size: 0.9rem;
      word-break: break-word;
    }
    th, td {
      padding: 0.5rem 0.3rem;
      text-align: center;
    }
    /* 搜尋按鈕 */
    .search-btn {
      margin-top: 1rem;
      text-align: center;
    }
    .search-btn .btn {
      width: 50%;
      max-width: 200px;
    }
    /* 手機額外調整 */
    @media (max-width: 650px) {
      .navbar-brand { font-size: 1.6rem; }
      .header-subtitle { font-size: 0.8rem; }
      .card-section { padding: 0.75rem; }
      .stat-row { font-size: 1rem; flex-wrap: wrap; }
      table { font-size: 0.75rem; }
      .piechart { width: 80px; height: 80px; }
      .step-group input { width: 3.5rem; }
    }
  </style>
</head>
<body>
  <nav class="navbar navbar-dark bg-primary">
    <div class="container-fluid">
      <span class="navbar-brand">足球賠率篩選工具</span>
    </div>
  </nav>
  <div class="container-fluid px-2">
    <div class="header-subtitle text-center">
      根據初盤、終盤所有條件組合快速篩選比賽，並精確統計每一項百分比。
    </div>
    <!-- Nav tabs -->
    <ul class="nav nav-tabs">
      <li class="nav-item"><a class="nav-link active" data-bs-toggle="tab" href="#ahTab">亞洲盤查詢</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#ouTab">大小球查詢</a></li>
      <li class="nav-item"><a class="nav-link" data-bs-toggle="tab" href="#euTab">歐洲盤查詢</a></li>
    </ul>
    <div class="text-center text-muted mt-2">版本時間：2025/07/27 下午09:30:00 (GMT+8)</div>

    <!-- Tab Content -->
    <div class="tab-content pt-3">

      <!-- 亞洲盤 -->
      <div class="tab-pane fade show active" id="ahTab">
        <fieldset class="card-section"><legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ahInitHand" class="form-select form-select-sm">
                <option value="">--</option>
              </select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主隊賠率：</label>
            <div class="col-auto"><input id="ahHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahHomeErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahHomeErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客隊賠率：</label>
            <div class="col-auto"><input id="ahAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahAwayErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahAwayErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <fieldset class="card-section"><legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ahCloseHand" class="form-select form-select-sm">
                <option value="">--</option>
              </select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主隊賠率：</label>
            <div class="col-auto"><input id="ahCloseHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahCloseHomeErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahCloseHomeErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahCloseHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客隊賠率：</label>
            <div class="col-auto"><input id="ahCloseAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ahCloseAwayErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ahCloseAwayErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ahCloseAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>

        <div class="search-btn">
          <button class="btn btn-primary" onclick="doAhSearch()">搜尋</button>
        </div>

        <div id="ahStat" class="stat-area"></div>
        <div class="table-wrap">
          <table id="ahTable" class="table table-striped">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th>
                <th>初盤盤口</th><th>初盤主隊賠率</th><th>初盤客隊賠率</th>
                <th>終盤盤口</th><th>終盤主隊賠率</th><th>終盤客隊賠率</th><th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- 大小球 -->
      <div class="tab-pane fade" id="ouTab">
        <fieldset class="card-section"><legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ouInitLine" class="form-select form-select-sm"><option value="">--</option></select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">大球賠率：</label>
            <div class="col-auto"><input id="ouBigExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouBigErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouBigErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouBigErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">細球賠率：</label>
            <div class="col-auto"><input id="ouSmallExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouSmallErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouSmallErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouSmallErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset class="card-section"><legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">盤口：</label>
            <div class="col-auto">
              <select id="ouCloseLine" class="form-select form-select-sm"><option value="">--</option></select>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">大球賠率：</label>
            <div class="col-auto"><input id="ouBigExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouBigErrC" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouBigErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouBigErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">細球賠率：</label>
            <div class="col-auto"><input id="ouSmallExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="ouSmallErrC" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('ouSmallErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('ouSmallErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
        <div class="search-btn">
          <button class="btn btn-primary" onclick="doOuSearch()">搜尋</button>
        </div>
        <div id="ouStat" class="stat-area"></div>
        <div class="table-wrap">
          <table id="ouTable" class="table table-striped">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th><th>盤口</th>
                <th>初盤大</th><th>初盤細</th>
                <th>終盤盤口</th><th>終盤大</th><th>終盤細</th><th>結果</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

      <!-- 歐洲盤 -->
      <div class="tab-pane fade" id="euTab">
        <fieldset class="card-section"><legend>初盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主勝：</label>
            <div class="col-auto"><input id="euHomeExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euHomeErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euHomeErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euHomeErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">和局：</label>
            <div class="col-auto"><input id="euDrawExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euDrawErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euDrawErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euDrawErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客勝：</label>
            <div class="col-auto"><input id="euAwayExact" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euAwayErr" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euAwayErr',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euAwayErr',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
        <fieldset class="card-section"><legend>終盤</legend>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">主勝：</label>
            <div class="col-auto"><input id="euHomeExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euHomeErrC" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euHomeErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euHomeErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row mb-2 align-items-center">
            <label class="col-auto form-label">和局：</label>
            <div class="col-auto"><input id="euDrawExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euDrawErrC" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euDrawErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euDrawErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
          <div class="row align-items-center">
            <label class="col-auto form-label">客勝：</label>
            <div class="col-auto"><input id="euAwayExactC" type="number" step="0.01" class="form-control form-control-sm" placeholder="精確值"></div>
            <div class="col-auto">±</div>
            <div class="col-auto">
              <div class="step-group">
                <input id="euAwayErrC" type="number" step="0.05" class="form-control form-control-sm" value="0.05">
                <div class="btn-wrap">
                  <button type="button" onclick="stepErr('euAwayErrC',0.05)">▲</button>
                  <button type="button" onclick="stepErr('euAwayErrC',-0.05)">▼</button>
                </div>
              </div>
            </div>
          </div>
        </fieldset>
        <div class="search-btn">
          <button class="btn btn-primary" onclick="doEuSearch()">搜尋</button>
        </div>
        <div id="euStat" class="stat-area"></div>
        <div class="table-wrap">
          <table id="euTable" class="table table-striped">
            <thead>
              <tr>
                <th>賽季</th><th>比賽</th>
                <th>初盤(主/和/客)</th><th>終盤(主/和/客)</th>
                <th>比分</th><th>勝負</th><th>淨勝球</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>
      </div>

    </div><!-- /.tab-content -->
  </div><!-- /.container-fluid -->

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // 讀入 JSON
    let AH = [], OU = [], EU = [];
    Promise.all([
      fetch('asian_handicap.json').then(r=>r.json()).then(d=>AH=d),
      fetch('over_under.json').then(r=>r.json()).then(d=>OU=d),
      fetch('european_odds.json').then(r=>r.json()).then(d=>EU=d),
    ]).then(initAll);

    function initAll(){
      // 填亞洲盤
      const ahInit = new Set(AH.map(r=>r.AH_open_handicap)),
            ahClose = new Set(AH.map(r=>r.AH_close_handicap));
      fillSelect('ahInitHand', ahInit);
      fillSelect('ahCloseHand', ahClose);
      // 填大小球
      const ouInit = new Set(OU.map(r=>r.OU_line)),
            ouClose = new Set(OU.map(r=>r.close_OU_line));
      fillSelect('ouInitLine', ouInit);
      fillSelect('ouCloseLine', ouClose);
      // 歐洲盤無下拉
    }
    function fillSelect(id, set){
      const arr = Array.from(set).filter(v=>v!==null&&v!==undefined).sort((a,b)=>a-b);
      const sel = document.getElementById(id);
      sel.innerHTML = '<option value="">--</option>' + arr.map(v=>`<option value="${v}">${v}</option>`).join('');
    }

    // 調整誤差
    function stepErr(id, d){
      const el = document.getElementById(id);
      let v = parseFloat(el.value)||0;
      v = Math.max(0, (v + d).toFixed(2));
      el.value = v;
    }

    // 計範圍
    function range(exId, errId){
      const ex = parseFloat(document.getElementById(exId).value),
            er = parseFloat(document.getElementById(errId).value)||0;
      return isNaN(ex)? [null,null] : [ex - er, ex + er];
    }
    function pct(n, t){ return t ? ((n/t*100).toFixed(1)+'%') : '0.0%'; }

    // 畫圓餅
    function drawPieChart(data){
      const total = data.reduce((sum,x)=>sum+x.val,0);
      if(!total) return '<svg class="piechart"></svg>';
      let cur = 0, sz=120, r=sz/2-2, cx=sz/2, cy=sz/2;
      const paths = data.map((d,i)=>{
        const ratio = d.val/total;
        const a1 = cur * 2 * Math.PI;
        cur += ratio;
        const a2 = cur * 2 * Math.PI;
        const x1 = cx + r * Math.sin(a1), y1 = cy - r * Math.cos(a1);
        const x2 = cx + r * Math.sin(a2), y2 = cy - r * Math.cos(a2);
        const large = (a2 - a1) > Math.PI ? 1 : 0;
        return `<path d="M${cx},${cy} L${x1},${y1} A${r},${r} 0 ${large} 1 ${x2},${y2} Z" fill="${d.color}"></path>`;
      }).join('');
      return `<svg class="piechart" viewBox="0 0 ${sz} ${sz}">${paths}</svg>`;
    }

    // 亞洲盤搜尋
    function doAhSearch(){
      const [hMin,hMax] = range('ahHomeExact','ahHomeErr'),
            [aMin,aMax] = range('ahAwayExact','ahAwayErr'),
            [hMinC,hMaxC] = range('ahCloseHomeExact','ahCloseHomeErr'),
            [aMinC,aMaxC] = range('ahCloseAwayExact','ahCloseAwayErr');
      const selO = document.getElementById('ahInitHand').value,
            selC = document.getElementById('ahCloseHand').value;
      const res = AH.filter(r=>{
        if(selO && r.AH_open_handicap != +selO) return false;
        if(selC && r.AH_close_handicap != +selC) return false;
        if(hMin!==null && (r.AH_open_home_odds<hMin||r.AH_open_home_odds>hMax)) return false;
        if(aMin!==null && (r.AH_open_away_odds<aMin||r.AH_open_away_odds>aMax)) return false;
        if(hMinC!==null && (r.AH_close_home_odds<hMinC||r.AH_close_home_odds>hMaxC)) return false;
        if(aMinC!==null && (r.AH_close_away_odds<aMinC||r.AH_close_away_odds>aMaxC)) return false;
        return true;
      });
      let win=0,draw=0,lose=0;
      const tb = document.querySelector('#ahTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs,as] = r.ft_score.split('-').map(Number),
              out = (hs + r.AH_close_handicap) - as > 0 ? '贏盤' :
                    (hs + r.AH_close_handicap) - as < 0 ? '輸盤' : '和盤';
        if(out==='贏盤') win++;
        else if(out==='輸盤') lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.AH_open_handicap}</td><td>${r.AH_open_home_odds}</td><td>${r.AH_open_away_odds}</td>
            <td>${r.AH_close_handicap}</td><td>${r.AH_close_home_odds}</td><td>${r.AH_close_away_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      const pie = drawPieChart([
        { label: '贏盤', val: win, color: '#e53b2d' },
        { label: '和盤', val: draw, color: '#27a146' },
        { label: '輸盤', val: lose, color: '#2166d1' },
      ]);
      document.getElementById('ahStat').innerHTML = `
        <div class="stat-row">
          <span class="win">贏盤 ${win} (${pct(win,tot)})</span>
          <span class="draw">和盤 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">輸盤 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="piebox">
          ${pie}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>贏盤</div>
            <div><span style="background:#27a146"></span>和盤</div>
            <div><span style="background:#2166d1"></span>輸盤</div>
          </div>
        </div>`;
    }

    // 大小球搜尋
    function doOuSearch(){
      const selO = document.getElementById('ouInitLine').value,
            selC = document.getElementById('ouCloseLine').value;
      const [bMin,bMax] = range('ouBigExact','ouBigErr'),
            [sMin,sMax] = range('ouSmallExact','ouSmallErr'),
            [bMinC,bMaxC] = range('ouBigExactC','ouBigErrC'),
            [sMinC,sMaxC] = range('ouSmallExactC','ouSmallErrC');
      const res = OU.filter(r=>{
        if(selO && r.OU_line != +selO) return false;
        if(selC && r.close_OU_line != +selC) return false;
        if(bMin!==null && (r.OU_open_over_odds<bMin||r.OU_open_over_odds>bMax)) return false;
        if(sMin!==null && (r.OU_open_under_odds<sMin||r.OU_open_under_odds>sMax)) return false;
        if(bMinC!==null && (r.OU_close_over_odds<bMinC||r.OU_close_over_odds>bMaxC)) return false;
        if(sMinC!==null && (r.OU_close_under_odds<sMinC||r.OU_close_under_odds>sMaxC)) return false;
        return true;
      });
      let over=0, push=0, under=0;
      const tb = document.querySelector('#ouTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const goals = r.ft_score.split('-').reduce((a,b)=>+a+ +b,0),
              out = goals > r.close_OU_line ? '大球' :
                    goals < r.close_OU_line ? '小球' : '走盤';
        if(out==='大球') over++;
        else if(out==='小球') under++;
        else push++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team} (${r.ft_score})</td>
            <td>${r.OU_line}</td>
            <td>${r.OU_open_over_odds}</td><td>${r.OU_open_under_odds}</td>
            <td>${r.close_OU_line}</td>
            <td>${r.OU_close_over_odds}</td><td>${r.OU_close_under_odds}</td>
            <td>${out}</td>
          </tr>`);
      });
      const tot = res.length;
      const pie = drawPieChart([
        { label: '大球', val: over, color: '#e53b2d' },
        { label: '走盤', val: push, color: '#27a146' },
        { label: '小球', val: under, color: '#2166d1' },
      ]);
      document.getElementById('ouStat').innerHTML = `
        <div class="stat-row">
          <span class="win">大球 ${over} (${pct(over,tot)})</span>
          <span class="draw">走盤 ${push} (${pct(push,tot)})</span>
          <span class="lose">小球 ${under} (${pct(under,tot)})</span>
        </div>
        <div class="piebox">
          ${pie}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>大球</div>
            <div><span style="background:#27a146"></span>走盤</div>
            <div><span style="background:#2166d1"></span>小球</div>
          </div>
        </div>`;
    }

    // 歐洲盤搜尋
    function doEuSearch(){
      const [hMin,hMax] = range('euHomeExact','euHomeErr'),
            [dMin,dMax] = range('euDrawExact','euDrawErr'),
            [aMin,aMax] = range('euAwayExact','euAwayErr'),
            [hMinC,hMaxC] = range('euHomeExactC','euHomeErrC'),
            [dMinC,dMaxC] = range('euDrawExactC','euDrawErrC'),
            [aMinC,aMaxC] = range('euAwayExactC','euAwayErrC');
      const res = EU.filter(r=>{
        if(hMin!==null && (r['1X2_open_home_odds']<hMin||r['1X2_open_home_odds']>hMax)) return false;
        if(dMin!==null && (r['1X2_open_draw_odds']<dMin||r['1X2_open_draw_odds']>dMax)) return false;
        if(aMin!==null && (r['1X2_open_away_odds']<aMin||r['1X2_open_away_odds']>aMax)) return false;
        if(hMinC!==null && (r['1X2_close_home_odds']<hMinC||r['1X2_close_home_odds']>hMaxC)) return false;
        if(dMinC!==null && (r['1X2_close_draw_odds']<dMinC||r['1X2_close_draw_odds']>dMaxC)) return false;
        if(aMinC!==null && (r['1X2_close_away_odds']<aMinC||r['1X2_close_away_odds']>aMaxC)) return false;
        return true;
      });
      let win=0, draw=0, lose=0, d1=0, d2=0, d3=0;
      const tb = document.querySelector('#euTable tbody');
      tb.innerHTML = '';
      res.forEach(r=>{
        const [hs, as] = r.ft_score.split('-').map(Number),
              diff = hs - as,
              out = diff>0 ? '主勝' : diff<0 ? '客勝' : '和局';
        if(diff>0){ win++; if(diff===1) d1++; else if(diff===2) d2++; else d3++; }
        else if(diff<0) lose++;
        else draw++;
        tb.insertAdjacentHTML('beforeend', `
          <tr>
            <td>${r.season}</td>
            <td>${r.home_team} vs ${r.away_team}</td>
            <td>${r['1X2_open_home_odds']}/${r['1X2_open_draw_odds']}/${r['1X2_open_away_odds']}</td>
            <td>${r['1X2_close_home_odds']}/${r['1X2_close_draw_odds']}/${r['1X2_close_away_odds']}</td>
            <td>${r.ft_score}</td>
            <td>${out}</td>
            <td>${diff}</td>
          </tr>`);
      });
      const tot = res.length;
      const pie = drawPieChart([
        { label: '主勝', val: win, color: '#e53b2d' },
        { label: '和局', val: draw, color: '#27a146' },
        { label: '客勝', val: lose, color: '#2166d1' },
      ]);
      document.getElementById('euStat').innerHTML = `
        <div class="stat-row">
          <span class="win">主勝 ${win} (${pct(win,tot)})</span>
          <span class="draw">和局 ${draw} (${pct(draw,tot)})</span>
          <span class="lose">客勝 ${lose} (${pct(lose,tot)})</span>
        </div>
        <div class="piebox">
          ${pie}
          <div class="pie-legend">
            <div><span style="background:#e53b2d"></span>主勝</div>
            <div><span style="background:#27a146"></span>和局</div>
            <div><span style="background:#2166d1"></span>客勝</div>
          </div>
        </div>`;
    }
  </script>
</body>
</html>
